# 에피소드 전용 대시보드 설계 및 구현 계획

> **날짜**: 2026-02-25
> **범위**: 대시보드에 에피소드 선택 드롭다운 추가 + 에피소드 전용 대시보드 뷰 + 위젯 시스템 확장
> **상태**: Phase A 착수

---

## 배경 (왜?)

현재 대시보드는 **모든 에피소드**의 통합 데이터만 보여준다. 에피소드를 클릭하면 ScenesView(씬 목록)로 직행하며, 에피소드 단위의 대시보드(위젯 기반 진행률 분석)는 존재하지 않는다.

사용자(감독/PD)가 특정 에피소드의 진행 현황을 한눈에 파악하려면, 에피소드 전용 대시보드가 필요하다.

---

## 설계서 전문

### 1. 탭 네비게이션

**전체 대시보드 (현재 상태 + 에피소드 탭 추가)**:
```
[통합] [배경(BG)] [액팅(ACT)] [에피소드 ▼]    [+ 위젯 추가]
                                  │
                            ┌─────┴──────┐
                            │ EP.01       │
                            │ EP.02       │
                            │ EP.03  ✓    │ ← 선택됨
                            │ EP.04       │
                            └─────────────┘
```

**에피소드 전용 대시보드 (EP 선택 후)**:
```
[← 뒤로가기] [통합] [배경(BG)] [액팅(ACT)]    [+ 위젯 추가]
```

**동작**:
- 전체 대시보드에서 [에피소드 ▼] 탭 클릭 → 드롭다운 메뉴 표시 (에피소드 목록)
- 방향키(↑↓) + Enter로 조작 가능
- EP 선택 시 → 에피소드 전용 대시보드로 전환
- 에피소드 대시보드에서:
  - [통합]: 해당 에피소드의 BG+ACT 통합 데이터
  - [배경(BG)]: 해당 에피소드의 BG 데이터만
  - [액팅(ACT)]: 해당 에피소드의 ACT 데이터만
  - [← 뒤로가기]: 전체 현황 대시보드로 복귀

### 2. 에피소드 대시보드 위젯 목록

| 위젯 ID | 이름 | 설명 | 지원 차트 |
|---------|------|------|----------|
| `ep-overall-progress` | EP 전체 진행률 | BG+ACT 통합 진행률 | 가로바/세로바/도넛/숫자카드 |
| `ep-part-progress` | 파트별 진행률 | 파트별 진행률 + 아코디언 BG/ACT 상세 | 가로바/숫자카드 |
| `ep-stage-bars` | 단계별 진행률 | LO/완료/검수/PNG 단계별 진행 | 가로바/세로바 |
| `ep-assignee-cards` | 담당자별 현황 | 이 에피소드 담당자 목록 | 카드형 고정 |
| `ep-dept-comparison` | BG/ACT 비교 | 부서별 진행률 비교 | 가로바/세로바/도넛 |
| `ep-part-bg-{partId}` | 파트 BG 진행률 | 특정 파트의 BG 단계별 진행률 | 가로바/세로바/도넛/숫자카드 |
| `ep-part-act-{partId}` | 파트 ACT 진행률 | 특정 파트의 ACT 단계별 진행률 | 가로바/세로바/도넛/숫자카드 |
| `ep-part-combined-{partId}` | 파트 전체 진행률 | 특정 파트의 BG+ACT 통합 진행률 | 가로바/세로바/도넛/숫자카드 |

### 3. 파트 아코디언 상세 (ep-part-progress 위젯 내)

```
┌─ 파트별 진행률 위젯 ──────────────────────────┐
│                                                │
│  A파트 ████████░░ 72%                    [▼]  │
│  ┌──────────────────────────────────────────┐  │
│  │ BG   █████░░░ 65%                       │  │
│  │  LO:90%  완료:72%  검수:55%  PNG:40%    │  │
│  │ ACT  ██████░░ 80%                       │  │
│  │  1원화:95% 2원화:80% 동화:70% 최종:55%  │  │
│  └──────────────────────────────────────────┘  │
│  B파트 ███░░░░░░ 45%                    [▶]  │
│  C파트 █░░░░░░░░ 20%                    [▶]  │
│                                                │
└────────────────────────────────────────────────┘
```

파트 클릭 → 아코디언 펼침 (BG/ACT 각각 + 단계별 상세). 다른 파트 클릭 시 기존 닫히고 새 파트 열림 (또는 복수 오픈 가능).

### 4. 파트 전용 위젯 추가 플로우

```
[위젯 추가 +] 클릭
  → ┌─────────────────────────┐
    │  위젯 추가               │
    │  ─────────────────────  │
    │  EP 전체 진행률          │
    │  파트별 진행률            │
    │  단계별 진행률            │
    │  담당자별 현황            │
    │  BG/ACT 비교            │
    │  ─────────────────────  │   ← 구분선
    │  ▶ 파트 BG 진행률        │ ─→ [A파트] [B파트] [C파트]
    │  ▶ 파트 ACT 진행률       │ ─→ [A파트] [B파트] [C파트]
    │  ▶ 파트 전체 진행률       │ ─→ [A파트] [B파트] [C파트]
    └─────────────────────────┘
```

파트 전용 위젯은 2단계 선택: 위젯 타입 → 파트 선택. 같은 파트에 대해 BG/ACT/전체를 각각 별도 위젯으로 추가 가능. 동일 파트-타입 위젯도 중복 추가 가능 (캘린더처럼).

### 5. 우클릭 차트 타입 전환 (전체 대시보드 + 에피소드 대시보드 모두 적용)

```
위젯 우클릭
  → ┌───────────────────────┐
    │  차트 표시 형식         │
    │  ─────────────────────│
    │  ✓ 가로 막대            │ ← 현재 선택됨
    │    세로 막대            │
    │    원형 (도넛)          │
    │    숫자 카드            │
    └───────────────────────┘
```

위젯마다 지원 가능한 차트 타입만 표시 (예: 담당자 카드는 카드형 고정). 선택 결과는 위젯 ID 기준으로 `preferences.json`에 저장. 전체 대시보드 기존 위젯에도 동일 적용.

### 6. 차트 타입별 렌더링

| 차트 타입 | 렌더링 |
|----------|--------|
| 가로 막대 | 현재와 동일한 수평 바 + 라벨 + 퍼센티지 |
| 세로 막대 | 세로 바 차트 (DepartmentComparison 하단 미니차트 스타일) |
| 원형 (도넛) | 도넛 차트 (OverallProgressWidget의 원형 차트 스타일) |
| 숫자 카드 | 큰 숫자 + 작은 라벨, 미니 스파크라인 또는 진행 표시 |

---

## 기술 구현 상세

### 상태 관리 (Zustand 확장)

**파일**: `src/stores/useAppStore.ts`

```typescript
// 추가할 필드
episodeDashboardEp: number | null;          // 선택된 에피소드 (null = 전체 대시보드)
setEpisodeDashboardEp: (ep: number | null) => void;
episodeWidgetLayout: Layout[] | null;       // 에피소드 대시보드 공유 레이아웃
setEpisodeWidgetLayout: (layout: Layout[]) => void;
chartTypes: Record<string, ChartType>;      // widgetId → 차트 타입
setChartType: (widgetId: string, type: ChartType) => void;
```

**파일**: `src/types/index.ts`

```typescript
export type ChartType = 'horizontal-bar' | 'vertical-bar' | 'donut' | 'stat-card';
```

### 데이터 흐름

```
useDataStore.episodes
  ├── calcDashboardStats(episodes, dept?)             // 기존: 전체 대시보드
  ├── calcEpisodeDetailStats(episodes, epNum)          // 신규: 에피소드 상세
  │    ├── overall: BG+ACT 통합 진행률
  │    ├── perDept: { bg: stats, acting: stats }
  │    ├── perPart: [{ partId, bgPct, actPct, combinedPct, stages }]
  │    └── perAssignee: [{ name, scenes, pct }]
  └── calcPartDetailStats(episodes, epNum, partId)     // 신규: 파트 상세
       ├── bg: { stages, overallPct }
       ├── acting: { stages, overallPct }
       └── combined: { overallPct }
```

### 파일 구조 (신규)

```
src/
├── components/widgets/
│   ├── episode/
│   │   ├── EpOverallProgressWidget.tsx    // EP 전체 진행률
│   │   ├── EpPartProgressWidget.tsx       // 파트별 진행률 + 아코디언
│   │   ├── EpStageBarsWidget.tsx          // EP 단계별 진행률
│   │   ├── EpAssigneeCardsWidget.tsx      // EP 담당자별 현황
│   │   ├── EpDeptComparisonWidget.tsx     // EP BG/ACT 비교
│   │   └── EpPartDetailWidget.tsx         // 파트 전용 (BG/ACT/전체)
│   ├── charts/
│   │   ├── HorizontalBar.tsx              // 가로 막대 차트 컴포넌트
│   │   ├── VerticalBar.tsx                // 세로 막대 차트 컴포넌트
│   │   ├── DonutChart.tsx                 // 도넛 차트 컴포넌트
│   │   └── StatCard.tsx                   // 숫자 카드 컴포넌트
│   └── ChartTypeContextMenu.tsx           // 우클릭 차트 전환 메뉴
├── utils/
│   └── calcStats.ts                       // 기존 + 신규 통계 함수 추가
└── views/
    └── Dashboard.tsx                      // 에피소드 탭 + 대시보드 전환 로직
```

### 레이아웃 저장

| 대시보드 | 저장 위치 | 키 |
|---------|----------|-----|
| 전체 (부서별) | `layout.json` | 기존 |
| 전체 (통합) | `layout-all.json` | 기존 `all` 키 |
| 에피소드 (공유) | `layout-episode.json` | 신규 `episode` 키 |
| 차트 타입 | `preferences.json` | `chartTypes` 필드 |

### 기존 코드 참조 패턴

**위젯 데이터 소비 패턴** (모든 위젯이 동일):
```typescript
// 예: OverallProgressWidget.tsx:88-93
const episodes = useDataStore((s) => s.episodes);
const dashboardFilter = useAppStore((s) => s.dashboardDeptFilter);
const isAll = dashboardFilter === 'all';
const dept = isAll ? undefined : dashboardFilter;
const stats = useMemo(() => calcDashboardStats(episodes, dept), [episodes, dept]);
```

**탭 시스템** (Dashboard.tsx:436-488):
- `dashboardDeptFilter`: `'all' | 'bg' | 'acting'`
- `handleDeptSelect(filter)` → `setDashboardDeptFilter(filter)` + `setSelectedDepartment(filter)`
- motion `layoutId="tab-indicator"` 기반 슬라이딩 인디케이터

**위젯 레이아웃** (Dashboard.tsx:209-226):
- `DEPT_LAYOUT` / `ALL_LAYOUT` — 기본 레이아웃 정의
- `ResponsiveGridLayout` with 24칸 그리드, rowHeight=16
- `saveLayout(layout, key?)` / `loadLayout(key?)` for 영속화

**설정 서비스** (settingsService.ts):
- `loadLayout(key?)` / `saveLayout(layout, key?)` — layout.json / layout-all.json
- `loadPreferences()` / `savePreferences()` — preferences.json
- `window.electronAPI.readSettings(file)` / `writeSettings(file, data)` 기반

---

## 구현 순서

1. **Phase A**: 기반 — 스토어 확장 + 통계 함수 + 탭 네비게이션 + 헤더
   - A1. Store 확장 (useAppStore.ts + types/index.ts)
   - A2. 통계 함수 추가 (calcStats.ts)
   - A3. Dashboard.tsx 탭 네비게이션 (에피소드 드롭다운 + EP 대시보드 탭 바)
   - A4. Header.tsx 제목 변경
   - → Phase A 완료 시: 에피소드 대시보드 진입/복귀 + 기존 위젯이 필터링된 데이터로 렌더링

2. **Phase B**: 에피소드 전용 위젯 + 차트 컴포넌트
   - B1. 차트 공통 컴포넌트 (HorizontalBar, VerticalBar, DonutChart, StatCard)
   - B2. 에피소드 전용 위젯 6종 + 파트 전용 위젯
   - B3. 파트 아코디언 상세

3. **Phase C**: 차트 타입 전환 + 위젯 추가 확장
   - C1. 우클릭 차트 타입 전환 메뉴
   - C2. 위젯 추가 피커 확장 (2단계 선택)
   - C3. 레이아웃 저장 (에피소드 전용)

---

## 주요 수정 대상 파일

| 파일 | 변경 규모 | Phase | 비고 |
|------|----------|-------|------|
| `src/stores/useAppStore.ts` | 소 (+15줄) | A | 상태 3개 + setter 3개 |
| `src/types/index.ts` | 소 (+5줄) | A | ChartType, EpisodeDetailStats 등 |
| `src/utils/calcStats.ts` | 중 (+80줄) | A | calcEpisodeDetailStats, calcPartDetailStats |
| `src/views/Dashboard.tsx` | 대 (+200줄) | A | 에피소드 탭 + 드롭다운 + EP 대시보드 분기 |
| `src/components/layout/Header.tsx` | 소 (+10줄) | A | 에피소드 제목 표시 |
| `src/services/settingsService.ts` | 소 (+15줄) | A+C | 에피소드 레이아웃 저장/로드 |
| `src/components/widgets/charts/*.tsx` | 중 (신규 4개) | B | 차트 공통 컴포넌트 |
| `src/components/widgets/episode/*.tsx` | 대 (신규 6개) | B | 에피소드 전용 위젯 |
| `src/components/widgets/ChartTypeContextMenu.tsx` | 중 (신규) | C | 우클릭 차트 전환 |

---

*이 문서는 에피소드 대시보드 구현 진행 시 참조용으로 사용합니다.*
*구현 완료 후 결과 및 변경사항을 하단에 추가합니다.*
