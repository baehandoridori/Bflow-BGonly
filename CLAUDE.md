# CLAUDE.md — BG 진행 현황판 (Bflow-BGonly)

> **프로젝트**: Studio JBBJ 사코팍 배경 레이아웃 진행 현황 대시보드
> **타입**: Electron + React + TypeScript 독립 앱
> **상태**: 계획 → 구현 단계 진입
> **원본 참고**: Bflow PWA (읽기 전용 참고, 직접 수정 금지)

---

## 프로젝트 개요

BG 진행 현황판은 Studio JBBJ 팀(~20명)이 에피소드별 배경 레이아웃 씬의 진행 상황을
실시간으로 추적하는 Electron 대시보드 앱이다. Google Sheets를 데이터 원본으로 사용하며,
추후 Bflow PWA에 위젯으로 통합할 예정이다.

### 핵심 콘셉트: "띄워놓고 작업"

슬랙 캔버스처럼 **항상 띄워놓고 실시간으로 협업**하는 도구.
- 여러 사용자가 동시에 앱을 열어두고 체크박스를 편집
- 한 사용자가 체크하면 → Google Sheets에 즉시 저장 → 다른 사용자가 새로고침/폴링 시 반영
- Google Sheets가 **단일 진실의 원천(Single Source of Truth)**

```
┌─ 사용자 A (PC) ─┐     ┌─ 사용자 B (PC) ─┐     ┌─ 사용자 C (PC) ─┐
│  Electron 앱     │     │  Electron 앱     │     │  Electron 앱     │
│  체크 → 저장     │     │  폴링 → 반영     │     │  체크 → 저장     │
└────────┬─────────┘     └────────┬─────────┘     └────────┬─────────┘
         │                        │                        │
         ▼                        ▼                        ▼
    ╔══════════════════════════════════════════════════════════╗
    ║            Google Sheets (단일 진실의 원천)               ║
    ║  EP01_A | EP01_B | EP02_A | ... | 담당자                 ║
    ╚══════════════════════════════════════════════════════════╝
```

---

## 경로 및 배포 구조

### 개발/테스트 경로
```
C:\Bflow-BGonly
```

### 배포 경로 (팀 공유)
```
G:\공유 드라이브\JBBJ 자료실\한솔이의 두근두근 실험실\Bflow-BGonly\
├── BG진행현황판.exe          ← 팀원들이 바로가기로 실행
└── resources/               ← Electron 패키지 리소스
```

> 배포 폴더는 **exe + 리소스만** 둔다. 데이터/설정은 여기에 저장하지 않는다.

### 개인 설정 경로 (각 사용자 PC)
```
%APPDATA%\Bflow-BGonly\                ← Electron: app.getPath('userData')
├── layout.json                        ← 개인 위젯 레이아웃 (react-grid-layout)
├── preferences.json                   ← 테마, 필터 기본값, 마지막 본 에피소드
└── cache/                             ← 이미지 캐시 (선택)
```

### 데이터 저장 전략

| 데이터 | 저장 위치 | 이유 |
|--------|----------|------|
| 씬/에피소드/진행률/체크박스 | **Google Sheets** | 단일 진실의 원천, 다중 사용자 실시간 공유 |
| 담당자 목록 | **Google Sheets** | 공유 데이터 |
| 앱 전역 설정 (시트 ID 등) | **앱 내 빌트인** 또는 **환경변수** | 빌드 시 포함 |
| 위젯 레이아웃 | **%APPDATA%/layout.json** | PC별 개인화, 충돌 없음 |
| 개인 설정 (테마 등) | **%APPDATA%/preferences.json** | PC별 개인화 |

### 동기화 모델

```
체크박스 토글 시:
  1. 로컬 상태 즉시 업데이트 (낙관적 업데이트, UI 즉시 반영)
  2. Google Sheets API 호출 (백그라운드)
  3. 실패 시 롤백 + 재시도 큐

다른 사용자 변경 감지:
  1. 주기적 폴링 (30초~1분 간격)
  2. Sheets 데이터 가져오기 → 로컬 상태와 diff
  3. 변경분만 UI에 반영 (깜빡임 없이 부드럽게)
```

### 제약 사항 및 주의점

1. **네트워크 의존성**: Google Sheets API 통신이 핵심 — 네트워크 필수
   - 체크박스 변경 시 오프라인이면 큐에 쌓았다가 복구 후 전송
   - 폴링 실패 시 재시도 (지수 백오프)
2. **경로 인코딩**: 배포 경로에 한글 포함 (`공유 드라이브`, `한솔이의 두근두근 실험실`)
   - Node.js `path` 모듈 사용, 하드코딩 피하기
3. **동시 편집 충돌**: 같은 셀을 두 사용자가 동시에 토글할 가능성
   - Last-Write-Wins 전략 (Google Sheets 기본 동작)
   - 폴링 주기를 적절히 설정하여 충돌 창(window) 최소화
4. **AppData 경로**: Electron의 `app.getPath('userData')` 사용
   - Windows: `C:\Users\{사용자}\AppData\Roaming\Bflow-BGonly\`
   - 앱 이름 설정 필요: `app.name = 'Bflow-BGonly'`

---

## 핵심 기능: 위젯 레이아웃 시스템

### Bflow 원본 참고 사항 (읽기 전용)

Bflow 원본(`/home/user/Bflow`)의 위젯 시스템 구조:
- **라이브러리**: `react-grid-layout` (ResponsiveGridLayout)
- **핵심 파일**: `src/views/Dashboard.tsx`, `src/components/widgets/Widget.tsx`
- **레이아웃 형식**: `{ i: string, x: number, y: number, w: number, h: number, minW, minH }`
- **그리드**: 4열 기반, 반응형 (lg/md/sm/xs/xxs 브레이크포인트)
- **편집 모드**: 드래그 핸들 + 리사이즈 핸들 + 편집/리셋 토글
- **저장**: Zustand persist → localStorage (우리는 AppData 파일 기반으로 대체)

### BGonly에서의 구현 방향

```
Bflow 방식 (localStorage)  →  BGonly 방식 (AppData 파일 기반)
─────────────────────────────────────────────────────────────
Zustand persist middleware  →  Zustand + Electron IPC 파일 persist
브라우저 localStorage       →  %APPDATA%/Bflow-BGonly/layout.json
PWA 단일 사용자             →  각 PC의 Windows 사용자별 자동 분리
작업 데이터 로컬 저장        →  Google Sheets가 싱글 소스 (폴링)
```

### 위젯 목록

| 위젯 ID | 이름 | 기본 크기 | 설명 |
|---------|------|----------|------|
| overall-progress | 전체 진행률 | 1x1 | 원형 진행률 |
| stage-bars | 단계별 진행률 | 2x1 | LO/완료/검수/PNG 바 차트 |
| assignee-cards | 담당자별 현황 | 2x1 | 담당자 카드 목록 |
| episode-summary | 에피소드 요약 | 2x2 | EP별 × 파트별 현황 |
| matrix-table | 매트릭스 | 2x1 | 담당자 × 단계 테이블 |
| scene-list | 씬 목록 | 전체 | 상세 목록 (이미지 포함) |

---

## 기술 스택

| 항목 | 기술 | 비고 |
|------|------|------|
| 프레임워크 | Electron + React 18 | 독립 실행형 |
| 언어 | TypeScript | 엄격 모드 |
| 스타일링 | Tailwind CSS | 다크 테마 기본 |
| 상태 관리 | Zustand | 파일 기반 persist |
| 위젯 시스템 | react-grid-layout | 드래그 & 리사이즈 |
| Google API | googleapis npm | 서비스 계정 인증 |
| 빌드/패키징 | electron-builder | Windows .exe |
| 이미지 | lazy loading + 캐싱 | 공유 캐시 |

### 디자인 시스템

```
배경:       #0F1117
카드:       #1A1D27
보더:       #2D3041
텍스트:     #E8E8EE
텍스트 약:  #8B8DA3
액센트:     #6C5CE7 (보라)

단계 컬러:
  LO    = #74B9FF (스카이블루)
  완료   = #A29BFE (라벤더)
  검수   = #FDCB6E (골드)
  PNG   = #00B894 (민트)
```

---

## 워크플로우 오케스트레이션

### 1. 플랜 모드 기본값

- 비자명한 작업(3단계 이상 또는 아키텍처 결정)에는 반드시 플랜 모드 진입
- 일이 틀어지면 즉시 STOP하고 재계획 — 계속 밀어붙이지 말 것
- 빌드뿐 아니라 검증 단계에도 플랜 모드 활용
- 모호함을 줄이기 위해 사전에 상세 스펙 작성

### 2. 서브에이전트 전략

- 메인 컨텍스트 윈도우를 깨끗하게 유지하기 위해 서브에이전트를 적극 활용
- 리서치, 탐색, 병렬 분석은 서브에이전트에 위임
- 복잡한 문제에는 서브에이전트를 통해 더 많은 컴퓨팅 투입
- 집중된 실행을 위해 서브에이전트당 하나의 작업만 배정

### 3. 자기개선 루프

- 사용자로부터 수정 받을 때마다 `tasks/lessons.md`에 패턴 업데이트
- 동일한 실수를 방지하는 규칙을 스스로 작성
- 실수율이 낮아질 때까지 이 레슨들을 가차 없이 반복 개선
- 세션 시작 시 관련 프로젝트의 레슨 검토

### 4. 완료 전 검증

- 작동을 증명하지 않고는 절대 작업 완료로 표시하지 말 것
- 필요 시 메인과 변경사항 간의 동작 차이를 비교
- "시니어 엔지니어가 이걸 승인할까?" 자문하기
- 테스트 실행, 로그 확인, 정확성 입증

### 5. 우아함 추구 (균형 잡힌)

- 비자명한 변경에는 "더 우아한 방법이 없을까?" 자문
- 수정이 임시방편처럼 느껴진다면: "지금 알고 있는 모든 것을 고려해 우아한 솔루션을 구현"
- 간단하고 명확한 수정에는 이 과정 생략 — 과잉 설계 금지
- 발표 전에 자신의 작업을 스스로 검토

### 6. 자율 버그 수정

- 버그 리포트를 받으면 그냥 고쳐라. 일일이 지시를 구하지 말 것
- 로그, 오류, 실패한 테스트를 직접 찾아 해결
- 사용자로부터 컨텍스트 전환 불필요
- 말하지 않아도 CI 실패 테스트는 직접 수정

---

## 태스크 관리

1. **계획 우선:** `tasks/todo.md`에 체크 가능한 항목으로 계획 작성
2. **계획 검증:** 구현 시작 전 확인
3. **진행 추적:** 진행하면서 항목 완료 표시
4. **변경 설명:** 각 단계에서 고수준 요약 제공
5. **결과 문서화:** `tasks/todo.md`에 검토 섹션 추가
6. **레슨 캡처:** 수정 후 `tasks/lessons.md` 업데이트

---

## 핵심 원칙

- **단순함 우선:** 모든 변경을 최대한 단순하게. 최소한의 코드 영향.
- **게으름 금지:** 근본 원인을 찾아라. 임시 수정 없음. 시니어 개발자 기준.
- **최소 영향:** 변경은 필요한 부분만. 새로운 버그 도입 금지.

---

## Git 규칙

### 브런치 명명 (필수)

- **브런치명은 반드시 한글로 작성한다** (필수 요건)
- 형식: `기능-{설명}` 또는 `수정-{설명}`
- 예시: `기능-위젯레이아웃`, `수정-시트동기화오류`, `기능-사용자설정저장`

### 작업 브런치

- 현재 세션 작업 브런치: `claude/create-workflow-docs-k4zeF`
- Bflow 원본 레포: **절대 수정하지 말 것** (참고 전용)

### 커밋 메시지

- 한글로 작성
- 변경 내용을 명확히 설명
- 예시: `위젯 레이아웃 저장/불러오기 구현`, `Google Sheets 연동 모듈 추가`

---

## 구현 로드맵 요약

### Phase 1: 기반 구축
- Electron + React + TypeScript + Tailwind 프로젝트 세팅
- Google Sheets API 인증 모듈 (서비스 계정)
- AppData 기반 개인 설정 읽기/쓰기 모듈 (Electron IPC)

### Phase 2: 핵심 UI
- 전체 현황 대시보드 (진행률, 바 차트, 담당자 카드)
- 에피소드별/파트별 현황
- 씬 목록 (이미지 + 체크박스 편집)

### Phase 3: 양방향 동기화
- 체크박스 → Google Sheets 즉시 업데이트
- 낙관적 업데이트 + 주기적 폴링
- 오프라인 큐잉

### Phase 4: 위젯 커스터마이징
- react-grid-layout 기반 드래그 & 리사이즈
- 사용자별 레이아웃 저장 (`%APPDATA%/Bflow-BGonly/layout.json`)
- Bflow 레이아웃 편집 UI 참고

### Phase 5: 배포
- electron-builder → Windows .exe
- 공유 드라이브 배포 (`G:\...\Bflow-BGonly\`)
- 팀원 온보딩 가이드

---

## 참조 문서

- **`ROADMAP.md`** — 향후 개발 로드맵 (Phase 1~5, 기능별 상세 스펙)
- `BG_DASHBOARD_PLAN.md` — 전체 구현 계획서 (565줄 상세 스펙)
- `bg-dashboard-architecture.mermaid` — 아키텍처 다이어그램
- `bg-dashboard-dataflow.mermaid` — 데이터 플로우 시퀀스 다이어그램
- Bflow 원본 (`/home/user/Bflow`) — 위젯 레이아웃 참고 (읽기 전용)

---

## 문서 갱신 규칙

**새 작업 또는 ROADMAP 항목 착수 시 반드시 이 문서들을 갱신할 것:**

1. **ROADMAP.md**: 해당 항목의 체크박스를 `[진행]` / `[완료]`로 변경
2. **CLAUDE.md**: 구현 로드맵 요약 섹션을 현재 상태에 맞게 업데이트
3. **package.json**: 기능 추가 시 마이너 버전, 버그 수정 시 패치 버전 증가

---

*문서 버전: 2026-02-19*
*작성: Claude × 한솔 (Studio JBBJ)*
