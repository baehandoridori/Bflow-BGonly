# B flow — 테스트 환경 구축 가이드 & 테스트 체크리스트

> **대상 버전**: Phase 0 완료 (0-1~0-6 + 내부 검수 수정)
> **작성일**: 2026-02-24

---

## 1. 테스트 환경 구축

### 1-1. 사전 준비물

| 항목 | 필요 버전 | 확인 명령 |
|------|----------|----------|
| Node.js | v18+ 권장 | `node -v` |
| npm | v9+ | `npm -v` |
| Git | 최신 | `git -v` |
| Google 계정 | Apps Script 배포 가능 | — |
| Google 스프레드시트 | 테스트용 빈 시트 1개 | — |

### 1-2. 로컬 앱 설치

```bash
# 1) 레포 클론 (이미 있으면 스킵)
git clone <repo-url> Bflow-BGonly
cd Bflow-BGonly

# 2) 의존성 설치
npm install

# 3) 타입 체크 + 빌드 확인
npx tsc --noEmit
npx vite build
```

### 1-3. Google Apps Script 웹 앱 배포

> 이미 배포된 웹 앱이 있으면 **Code.gs를 최신 버전으로 교체 후 새 배포**만 하면 됩니다.

1. **테스트용 Google 스프레드시트** 생성 (빈 시트)
2. 메뉴: `확장 프로그램` → `Apps Script`
3. 에디터에서 기존 코드를 모두 지우고 `apps-script/Code.gs` 내용 전체 붙여넣기
4. `Ctrl+S` 저장
5. 왼쪽 ⚙ **프로젝트 설정** → `"에디터에서 appsscript.json 매니페스트 파일 표시"` 체크
6. `appsscript.json` 열어서 `apps-script/appsscript.json` 내용으로 교체 후 저장:
   ```json
   {
     "timeZone": "Asia/Seoul",
     "dependencies": {},
     "webapp": { "access": "ANYONE_ANONYMOUS", "executeAs": "USER_DEPLOYING" },
     "exceptionLogging": "STACKDRIVER",
     "runtimeVersion": "V8",
     "oauthScopes": [
       "https://www.googleapis.com/auth/spreadsheets",
       "https://www.googleapis.com/auth/drive"
     ]
   }
   ```
7. **배포** → **새 배포**:
   - 유형: `웹 앱`
   - 실행 주체: `본인 (나)`
   - 액세스 권한: `모든 사용자`
8. 권한 승인 (Drive 접근 포함) → **배포 URL 복사**

### 1-4. 앱에 URL 연결

**방법 A: config.ts 직접 수정** (개발용)
```typescript
// src/config.ts
export const DEFAULT_WEB_APP_URL = '여기에_복사한_URL_붙여넣기';
```

**방법 B: 앱 설정 화면에서 입력** (이미 빌드된 앱)
1. 앱 실행 → 설정(⚙) → Google Sheets 연결 → URL 입력 → 저장
2. `%APPDATA%/Bflow-BGonly/sheets-config.json`에 저장됨

### 1-5. 개발 모드 실행

```bash
# Vite dev server + Electron 핫리로드
npm run dev
```

> **주의**: `npm run dev`는 Vite + Electron 동시 실행. 코드 변경 시 자동 핫리로드됨.

### 1-6. 프로덕션 빌드 테스트

```bash
# Vite 빌드만 (Electron 패키징 제외)
npm run build:vite

# 전체 빌드 (Electron 패키징 포함 — Windows 환경에서만)
npm run build
```

### 1-7. 테스트 데이터 초기화

앱 실행 후 아래 순서로 테스트 데이터를 준비:

1. **에피소드 추가**: 씬 관리 화면 → `+ 에피소드` → 번호 입력 (예: 1)
2. **파트 추가**: `+ 파트` → A파트 자동 생성
3. **씬 추가**: `+ 씬 추가` → 씬번호/담당자/메모 입력
4. **체크박스 토글**: LO/완료/검수/PNG 체크박스 클릭
5. Google 스프레드시트에서 실제 데이터가 반영되었는지 확인

---

## 2. 테스트 체크리스트

### 표기법
- `[ ]` 미검증
- `[P]` 통과
- `[F]` 실패 (사유 기록)
- `[S]` 건너뜀 (해당 없음)

---

### 2-1. 기본 앱 시작

| # | 항목 | 결과 | 비고 |
|---|------|------|------|
| 1.1 | `npm run dev`로 앱 정상 실행 | [ ] | |
| 1.2 | 시트 연결 성공 (좌측 하단 연결 상태 표시) | [ ] | |
| 1.3 | 에피소드 데이터 정상 로드 | [ ] | |
| 1.4 | 대시보드 위젯 정상 렌더링 | [ ] | |
| 1.5 | 로그인/사용자 선택 정상 동작 | [ ] | |

---

### 2-2. Phase 0-1: 배치 엔드포인트 / 재시도 / 롤백

| # | 항목 | 결과 | 비고 |
|---|------|------|------|
| 2.1 | 에피소드 추가 시 배치 요청 (에피소드 + 파트 + _REGISTRY 동시) | [ ] | DevTools Network 탭에서 `action=batch` 확인 |
| 2.2 | 체크박스 토글 → 즉시 UI 반영 (낙관적 업데이트) | [ ] | |
| 2.3 | 체크박스 토글 → 시트에 실제 반영 확인 | [ ] | Google Sheets에서 확인 |
| 2.4 | **[롤백 테스트]** 네트워크 차단 후 체크박스 토글 → 에러 후 원래 상태 복원 | [ ] | DevTools → Network → Offline |
| 2.5 | **[롤백 테스트]** 씬 추가 실패 시 추가된 씬이 UI에서 사라지는지 | [ ] | |
| 2.6 | **[롤백 테스트]** 파트 추가 실패 시 추가된 파트가 UI에서 사라지는지 | [ ] | |
| 2.7 | **[롤백 테스트]** 씬 삭제 실패 시 삭제된 씬이 UI에 복원되는지 | [ ] | |
| 2.8 | **[롤백 테스트]** 파트 삭제 실패 시 파트가 UI에 복원되는지 | [ ] | |
| 2.9 | **[롤백 테스트]** 에피소드 삭제 실패 시 에피소드가 UI에 복원되는지 | [ ] | |
| 2.10 | **[롤백 테스트]** 필드 수정 실패 시 이전 값으로 복원되는지 | [ ] | 담당자/메모 등 |

---

### 2-3. Phase 0-2: _REGISTRY 탭

| # | 항목 | 결과 | 비고 |
|---|------|------|------|
| 3.1 | 에피소드 추가 시 `_REGISTRY` 탭에 행 생성 확인 | [ ] | 스프레드시트에서 직접 확인 |
| 3.2 | 파트 추가 시 `_REGISTRY` 탭에 행 생성 확인 | [ ] | |
| 3.3 | 에피소드 아카이빙 → `_REGISTRY`에서 상태 변경 확인 | [ ] | `archived=true` |
| 3.4 | 아카이빙 해제 → `_REGISTRY`에서 상태 복원 확인 | [ ] | |
| 3.5 | 앱 재시작 후 `_REGISTRY` 기반으로 에피소드 목록 정상 로드 | [ ] | |

---

### 2-4. Phase 0-3: _COMMENTS 탭 (댓글)

| # | 항목 | 결과 | 비고 |
|---|------|------|------|
| 4.1 | 씬 상세 → 댓글 입력 → 저장 성공 | [ ] | |
| 4.2 | `_COMMENTS` 탭에 댓글 행 생성 확인 | [ ] | 스프레드시트에서 확인 |
| 4.3 | 댓글 수정 → `_COMMENTS` 탭 반영 확인 | [ ] | |
| 4.4 | 댓글 삭제 → `_COMMENTS` 탭에서 제거 확인 | [ ] | |
| 4.5 | @멘션 → 해당 사용자 이름 태그 정상 동작 | [ ] | |
| 4.6 | 다른 파트로 전환 시 댓글 캐시 무효화 후 재로드 | [ ] | |
| 4.7 | 앱 재시작 후 댓글 정상 로드 | [ ] | |

---

### 2-5. Phase 0-4: _USERS 탭 (사용자 동기화)

| # | 항목 | 결과 | 비고 |
|---|------|------|------|
| 5.1 | 사용자 생성 → `_USERS` 탭에 행 생성 확인 | [ ] | |
| 5.2 | 사용자 정보 수정 → `_USERS` 탭 반영 확인 | [ ] | |
| 5.3 | 사용자 삭제 → `_USERS` 탭에서 제거 확인 | [ ] | |
| 5.4 | 다른 PC에서 앱 실행 시 같은 사용자 목록 표시 | [ ] | 동기화 확인 |
| 5.5 | 비밀번호가 Base64로 인코딩되어 저장 | [ ] | `_USERS` 탭에서 직접 확인 |

---

### 2-6. Phase 0-5: 대량 씬 추가

| # | 항목 | 결과 | 비고 |
|---|------|------|------|
| 6.1 | 씬 추가 폼 → 대량 모드 전환 (시작~끝 범위) | [ ] | |
| 6.2 | 5개 이상 씬 대량 추가 → 로딩 오버레이 표시 | [ ] | |
| 6.3 | 대량 추가 완료 후 모든 씬이 UI에 표시 | [ ] | |
| 6.4 | 대량 추가된 씬이 스프레드시트에 정상 반영 | [ ] | |
| 6.5 | 대량 추가 중 실패 시 에러 메시지 표시 | [ ] | |
| 6.6 | 70개 이상 씬 추가 시에도 1~2초 내 완료 | [ ] | setValues 최적화 확인 |

---

### 2-7. Phase 0-6: 테스트 모드 완전 제거

| # | 항목 | 결과 | 비고 |
|---|------|------|------|
| 7.1 | 사이드바에 `TEST` 배지 없음 | [ ] | |
| 7.2 | 설정 화면에 `앱 모드` 표시 없음 | [ ] | |
| 7.3 | 시트 미연결 시 빈 화면 (테스트 데이터 X) | [ ] | 이전에는 로컬 JSON 표시했음 |
| 7.4 | 모든 CRUD가 시트를 통해서만 동작 | [ ] | |

---

### 2-8. 낙관적 업데이트 롤백 (내부 검수 수정사항)

| # | 항목 | 결과 | 비고 |
|---|------|------|------|
| 8.1 | 파트 추가 실패 → 이전 파트 목록 + 선택 상태 복원 | [ ] | |
| 8.2 | 씬 추가 실패 → 추가된 씬 제거 | [ ] | |
| 8.3 | 씬 삭제 실패 → 삭제된 씬 복원 | [ ] | |
| 8.4 | 필드 수정 실패 → 이전 값 복원 | [ ] | |
| 8.5 | 파트 삭제 실패 → 파트 복원 + 선택 상태 복원 | [ ] | |
| 8.6 | 에피소드 삭제 실패 → 에피소드 복원 + 선택 복원 | [ ] | |
| 8.7 | 에러 메시지에 `Unknown action` 포함 시 재배포 안내 표시 | [ ] | 모든 핸들러 공통 |
| 8.8 | 에러 메시지가 일관된 형식 (`XX 실패: ...`) | [ ] | |

---

### 2-9. 시트 연결 안정성

| # | 항목 | 결과 | 비고 |
|---|------|------|------|
| 9.1 | 앱 시작 시 시트 자동 연결 | [ ] | config.ts URL 기반 |
| 9.2 | 시트 연결 끊김 후 데이터 로드 시 자동 재연결 시도 | [ ] | App.tsx loadData |
| 9.3 | 재연결 성공 후 데이터 정상 로드 | [ ] | |
| 9.4 | 재연결 실패 시 에러 메시지 표시 (앱 크래시 X) | [ ] | |

---

### 2-10. 위젯 팝업

| # | 항목 | 결과 | 비고 |
|---|------|------|------|
| 10.1 | 대시보드에서 위젯 팝업 열기 | [ ] | |
| 10.2 | 위젯 팝업 데이터 정상 로드 | [ ] | |
| 10.3 | 시트 연결 실패 시 빈 상태로 시작 (크래시 X) | [ ] | |
| 10.4 | 30초 주기 폴링으로 데이터 갱신 | [ ] | |
| 10.5 | AOT(항상 위) 토글 동작 | [ ] | |
| 10.6 | 독 모드 (최소화 → pill) 동작 | [ ] | |

---

### 2-11. 다중 사용자 동시 사용

| # | 항목 | 결과 | 비고 |
|---|------|------|------|
| 11.1 | 2대 PC에서 동시 실행 → 양쪽 데이터 동기화 | [ ] | |
| 11.2 | A가 체크박스 토글 → B에서 30초 내 반영 | [ ] | 폴링 주기 |
| 11.3 | A가 씬 추가 → B에서 30초 내 반영 | [ ] | |
| 11.4 | 동시 편집 시 Last-Write-Wins로 충돌 없음 | [ ] | |

---

### 2-12. UI/UX 기본 동작

| # | 항목 | 결과 | 비고 |
|---|------|------|------|
| 12.1 | BG ↔ 액팅 부서 전환 | [ ] | |
| 12.2 | 에피소드 목록 → 에피소드 선택 → 파트 선택 → 씬 목록 | [ ] | |
| 12.3 | 씬 뷰 모드 전환 (카드/테이블/리스트) | [ ] | |
| 12.4 | 정렬 (씬번호/담당자/진행률) | [ ] | |
| 12.5 | 필터 (전체/진행중/완료/미시작) | [ ] | |
| 12.6 | 검색 기능 | [ ] | |
| 12.7 | Spotlight 검색 (Ctrl+K) | [ ] | |
| 12.8 | 씬 상세 모달 (클릭/더블클릭) | [ ] | |
| 12.9 | 이미지 업로드 (스토리보드/가이드) | [ ] | |
| 12.10 | 에피소드 제목/메모 편집 | [ ] | |
| 12.11 | 파트 메모 편집 | [ ] | |
| 12.12 | 에피소드 아카이빙 → 목록에서 제거 → 아카이브 탭에서 표시 | [ ] | |
| 12.13 | 아카이빙 해제 → 목록에 복원 | [ ] | |
| 12.14 | 테마 변경 (다크/라이트) | [ ] | |
| 12.15 | 라쏘 드래그 선택 → 일괄 체크박스 토글 | [ ] | |

---

## 3. 롤백 테스트 방법 (상세)

네트워크 차단으로 시트 API 실패를 인위적으로 유발하여 롤백 동작을 테스트합니다.

### 방법 1: DevTools 네트워크 차단

1. 앱에서 `Ctrl+Shift+I` → DevTools 열기
2. **Network** 탭 → **Throttling** 드롭다운 → `Offline` 선택
3. 원하는 작업 수행 (씬 추가, 파트 삭제 등)
4. 에러 alert 확인 → UI가 이전 상태로 복원되는지 확인
5. 테스트 후 Throttling을 `No throttling`으로 복원

### 방법 2: 잘못된 URL 설정

1. 설정 → Google Sheets URL을 `https://example.com/invalid`로 변경
2. 작업 수행 → 실패 확인
3. 원래 URL로 복원

### 방법 3: GAS 웹 앱 비활성화

1. Apps Script 에디터에서 배포 관리 → 배포 보관
2. 앱에서 작업 수행 → 실패 확인
3. 다시 새 배포

---

## 4. 알려진 제한사항

| 항목 | 설명 |
|------|------|
| 동시 편집 충돌 | Last-Write-Wins — 동시에 같은 셀을 수정하면 마지막 저장이 적용 |
| 폴링 지연 | 다른 사용자 변경은 최대 30초 지연 |
| GAS 실행 제한 | Google Apps Script 6분/실행, 일일 호출 제한 있음 |
| Windows 전용 빌드 | `electron-builder` 패키징은 Windows에서만 동작 |
| 한글 경로 | 배포 경로에 한글 포함 → `path` 모듈 사용 필수 |

---

*작성: Claude × 한솔 (Studio JBBJ) — 2026-02-24*
