# ROADMAP.md — Bflow 프로덕션 현황 관리 도구 개발 로드맵

> **최종 갱신**: 2026-02-27 (Phase 8-0~8-1, 8-3 완료 반영)
> **프로젝트**: Bflow (Studio JBBJ 프로덕션 진행 현황 대시보드)
> **담당**: Claude × 한솔 (Studio JBBJ)
> **현재 상태**: Phase 0 (0-4 제외) 완료, Phase 1~2 완료, Phase 4-1~4-3 완료, Phase 6 Step 1~4 완료, Phase 7 완료, Phase 8-0~8-1, 8-3 완료

---

## 범례

| 표기 | 의미 |
|------|------|
| `[완료]` | 구현 완료, 운영 중 |
| `[진행]` | 현재 구현 중 |
| `[다음]` | 다음 착수 예정 |
| `[ ]` | 미착수 |
| `P1` ~ `P8` | 개발 페이즈 |
| `난이도: ●○○` | 낮음 / `●●○` 중간 / `●●●` 높음 |

---

## 전체 진행 현황 (Overview)

```
Phase 0: 긴급 안정화           ████████░░ 0-1~0-3, 0-5~0-6 완료 ✅ (0-4 선택적)
Phase 1: 핵심 씬 관리         ██████████ 완료 ✅
Phase 2: 이미지 리뷰           ██████████ 완료 ✅
Phase 3: 알림 & 협업           ██░░░░░░░░ 댓글 시스템 구현 완료 (알림/슬랙 미착수)
Phase 4: 뷰 확장               ████████░░ 4-1~4-3 완료 ✅ + 스케줄/팀뷰 추가 (4-4 대기)
Phase 5: 커스터마이징           ░░░░░░░░░░ 미착수
Phase 6: 멀티 부서 확장        ████████░░ Step 1~4 완료 ✅ (Step 5 대기)
Phase 7: 대시보드 UX 혁신      ██████████ 7-1~7-5, 7-2 AOT 위치저장 완료 ✅
Phase 8: 설정 개인화            ████░░░░░░ 8-0~8-1, 8-3 완료 ✅ (8-4~8-5 다음)
```

---

## Phase 0: 긴급 안정화 — Google Sheets 연동 신뢰성 `[진행]`

> **목표**: 여러 동작을 동시에 수행할 때 일부만 반영되고 나머지가 롤백되는 근본적 문제 해결.
> **영향도**: 모든 사용자가 매일 겪는 핵심 안정성 이슈. 파트/씬 추가 시 부분 실패 → 사용자 혼란.
> **배경**: 현재 구조는 1개 동작 = 1번 HTTP 요청. 파트 3개 추가 시 요청 3번이 각각 독립적으로 실행되어
>   일부만 성공하고 나머지 실패 가능. 낙관적 업데이트로 UI에는 다 반영되었다가 동기화 시 롤백.

### 0-1. Apps Script 배치(Batch) 엔드포인트 `P0` `[완료]`

> 난이도: ●●○ | 완료일: 2026-02-25
> 효과: 부분 실패 완전 해결 + 속도 3배 이상 향상

- [x] **GAS `batch` action 추가**: `doPost`에 `action=batch` 핸들러 (Code.gs:265-294)
  - 요청 바디: `{ actions: [{ action: 'addPart', params: {...} }, ...] }`
  - 단일 스크립트 실행에서 모든 작업 순차 처리
  - 하나라도 실패 시 전체 에러 반환 (fail-fast, `failedAt` + `completedResults` 포함)
  - 최대 20 액션/배치 제한
- [x] **클라이언트 `gasBatch()` 함수 추가**: `electron/sheets.ts:105`에 배치 전송 헬퍼
  - `batchToSheets()` (sheetsService.ts:67) — 20개 초과 시 자동 청킹
  - `batchActions` 타입 안전 빌더 (sheetsService.ts:90-125)
- [x] **에피소드 추가 배치 적용**: BG+ACT 파트를 한 번의 배치로 생성 (ScenesView.tsx:1793-1797)
- [x] **파트 추가 배치 적용**: 동일 에피소드에 BG+ACT 파트 동시 생성 (ScenesView.tsx:1853-1854)
- [x] **기존 개별 API 하위 호환 유지**: batch가 아닌 기존 요청도 정상 동작

```
GAS 구현 예시 (Code.gs):

function doPost(e) {
  const body = JSON.parse(e.postData.contents);

  if (body.action === 'batch') {
    const results = [];
    for (const op of body.actions) {
      try {
        const result = executeAction(op.action, op.params);
        results.push({ ok: true, data: result });
      } catch (err) {
        // 하나라도 실패 → 전체 실패 반환
        return jsonResponse({ ok: false, error: err.message, failedAt: results.length });
      }
    }
    return jsonResponse({ ok: true, results });
  }
  // ... 기존 로직
}

클라이언트 사용:
  await gasBatch([
    { action: 'addEpisode', params: { episodeNumber: 4, department: 'bg' } },
    { action: 'addEpisode', params: { episodeNumber: 4, department: 'acting' } },
    { action: 'addPart', params: { episodeNumber: 4, partId: 'A', department: 'bg' } },
    { action: 'addPart', params: { episodeNumber: 4, partId: 'A', department: 'acting' } },
  ]);
  // 1번의 HTTP 요청으로 4개 작업 원자적 처리
```

### 0-2. 낙관적 업데이트 롤백 보강 `P0` `[완료]`

> 난이도: ●○○ | 완료일: 2026-02-25

- [x] **아카이브 실패 시 archivedEpisodes 롤백**: `prevArchivedEpisodes` 저장 후 catch에서 복원 (ScenesView.tsx:2096,2122)
- [x] **삭제/수정 등 다른 낙관적 동작도 롤백 점검**: 아카이브 해제도 동일 패턴 적용 (ScenesView.tsx:2144,2162)
- [x] **배치 엔드포인트(0-1)와 함께 적용**: 아카이브 다단계 호출을 배치로 묶어 부분 실패 제거 + `archiveGuardRef` 중복 방지

### 0-3. 클라이언트 재시도(Retry) 로직 `P0` `[완료]`

> 난이도: ●○○ | 완료일: 2026-02-25

- [x] **자동 재시도**: `gasFetchWithRetry()` (sheets.ts:58-101) — 최대 2회 재시도 (지수 백오프: 1초, 3초)
  - 5xx/429 서버 에러, 네트워크 오류만 재시도
  - 4xx 클라이언트 에러는 즉시 실패 처리
- [x] **재시도 중 UI 표시**: `sheets:retry-notify` IPC 이벤트 → App.tsx에서 기존 토스트로 "동기화 재시도 중..." 표시

### 0-4. 테스트 모드 제거 검토 `P0` `[선택]`

> 난이도: ●●○ | 코드 간소화 — 필요시 진행

**현황 분석 (2026-02-24):**
- 테스트 모드: 로컬 JSON 파일로 동작 (개발용)
- 라이브 모드: Google Sheets + Apps Script (운영용)
- 분기 기준: `sheetsConnected` 불리언 (ScenesView.tsx 17개소+)
- 영향 범위: `testSheetService.ts` (372줄 전체), `main.ts` 파일 워처 (~50줄)

**제거 시 효과:**
- ScenesView.tsx의 17개+ `if(sheetsConnected)` 분기 제거 → 코드 대폭 단순화
- testSheetService.ts 372줄 삭제
- 유지보수 부담 경감 (새 기능마다 두 경로 구현 불필요)

**제거 시 잃는 것:**
- 인터넷/Sheets 없이 로컬 테스트 불가
- 샘플 데이터 자동 생성 기능

**결정**: 배치 엔드포인트(0-1) 완료 후 판단. 코드 간소화 이점이 크나, 긴급하진 않음.

### 0-5. 종료 시 미완료 배치 큐 보장 `P0` `[완료]`

> 난이도: ●●○ | 완료일: 2026-02-26 | 대량 삭제/수정 중 앱 종료 시 데이터 일관성 보장

**문제**: 50개 씬 삭제 시 3번의 청크 요청(20+20+10)이 순차 전송되는데, 2번째 요청 도중 앱을 종료하면:
- 20개만 실제 삭제, 나머지 30개는 Google Sheets에 남음
- 낙관적 업데이트로 UI에선 50개 모두 제거된 상태
- 앱 재시작 시 Sheets 동기화로 삭제 안 된 30개가 부활
- 인덱스 기반 삭제이므로 행 번호 어긋남 위험

**해결 방안**:
```
앱 종료 요청 (X 버튼 / Alt+F4)
  → 'before-quit' 이벤트에서 미완료 큐 확인
  → 큐 있으면 종료 보류 (e.preventDefault())
  → 남은 청크 순차 전송
  → 완료 후 app.quit() 호출 → 실제 프로세스 종료

크래시 대비 (선택):
  → 큐를 로컬 JSON 파일로 영속화
  → 앱 재시작 시 큐 파일 확인 → 이어서 처리
```

- [x] **진행 중 작업 추적**: `sheets.ts`에 `pendingOps` 카운터 + `trackPending()` 래퍼로 쓰기 작업 추적
  - `gasGet`, `gasBatch`, `bulkUpdateCells`, `addScenes`, `uploadImage` 래핑
  - `waitForAllPendingOps(timeout)` — Promise 기반 대기
- [x] **before-quit 훅**: `pendingOps > 0`이면 종료 보류, 최대 15초 대기 후 `app.quit()`
- [x] **종료 보류 UI**: "저장 중..." 풀스크린 오버레이 + 스피너 (App.tsx)
- [ ] **(선택) 큐 영속화**: `%APPDATA%/Bflow-BGonly/pending-queue.json`으로 크래시 대비
- [ ] **(선택) 재시작 시 큐 복원**: startup 시 큐 파일 확인 → 이어서 처리

```
구현 순서:
  Step 1: GAS batch action 구현 + 재배포 ← ✅ 완료
  Step 2: 클라이언트 gasBatch() 함수 + 에피소드/파트 추가에 적용 ← ✅ 완료
  Step 3: 낙관적 업데이트 롤백 보강 (아카이브 등 복합 동작) ← ✅ 완료
  Step 4: 재시도 로직 추가 ← ✅ 완료 (UI 토스트 포함)
  Step 5: (선택) 테스트 모드 제거 검토
  Step 6: 종료 시 미완료 배치 큐 보장
```

### 0-6. 위젯 팝업 위치/크기 저장 및 복원 `P1` `[완료]`

> 난이도: ●●○ | 완료일: 2026-02-26 | 앱 재시작 시 위젯 팝업 위치/크기/AOT 상태 유지

**니즈**: 위젯 팝업을 여러 개 띄워두고 위치를 배치한 뒤, 앱 종료 후 재시작하면 마지막 상태 그대로 복원.

**구현 방안**:
```
저장:
  - %APPDATA%/Bflow-BGonly/widget-positions.json
  - 위젯별: { x, y, width, height, aot, isDocked }
  - 저장 타이밍: move/resize 이벤트 디바운스(500ms) + 앱 종료 시

복원:
  - 앱 시작 시 JSON 로드 → 저장된 위젯 자동 팝업 생성
  - 위치/크기 적용 + AOT 상태 복원
  - 모니터 해상도 변경 대비: 화면 밖 → 가시 영역 내로 보정
```

- [x] **위젯 상태 저장**: move/resize 이벤트 디바운스(500ms)로 `widget-positions.json` 파일 업데이트
- [x] **팝업 생성 시 복원**: `widget:open-popup`에서 캐시 읽어 저장된 위치/크기/AOT 적용
- [x] **화면 밖 보정**: `screen.getDisplayNearestPoint()`로 모니터 workArea 내 좌표 클램핑
- [x] **opacity/AOT 복원**: `widgetGetSavedState` IPC로 렌더러에서 초기값 로드 (WidgetPopup.tsx)
- [ ] **독 모드 상태 복원**: 독 상태였던 위젯은 독 모드로 복원

---

## Phase 1: 핵심 씬 관리 강화 `[완료]`

> **목표**: 현재 씬 목록 뷰의 가시성과 조작성을 프로덕션 수준으로 끌어올린다.
> **영향도**: 매일 쓰는 핵심 워크플로우 직접 개선. 체감 효과 즉시.
> **완료일**: 2026-02-19

### 1-1. 씬 목록 정렬 및 가시성 개선 `P1` `[완료]`

> 난이도: ●●○ | 참고: ftrack 멀티레벨 그룹핑, Kitsu 상태 매트릭스

- [x] **정렬 옵션 드롭다운**: 씬번호순 (기본), 담당자순, 진행률순, 미완료 우선
- [x] **정렬 방향 토글**: 오름차순 ↑ / 내림차순 ↓
- [x] **상태 필터 칩**: "미착수", "진행중", "완료" 등 빠른 필터 (담당자 필터와 병렬)
- [x] **컬러 코딩 강화**: 진행률에 따른 카드 좌측 보더 컬러 (0%=빨강, 50%=노랑, 100%=초록)
- [x] **리스트 뷰 / 카드 뷰 토글**: 카드(현재) + 테이블(밀집 정보) 전환

```
UX 참고:
- ftrack: 스프레드시트/썸네일 레이아웃 토글 + 멀티레벨 그룹핑 툴바
- Kitsu: 씬(행) × 단계(열) 컬러 매트릭스 — 가장 정보밀도 높은 뷰
- ShotGrid: 리스트/썸네일/디테일 3단 토글
```

### 1-2. 레이아웃별 씬 그룹핑 `P1` `[완료]`

> 난이도: ●●● | 핵심 기능 — BG 작업은 레이아웃 단위로 진행되므로 필수

- [x] **레이아웃 번호 필드 추가**: Scene 타입에 `layoutId: string` 필드 추가
  - 카드에서 클릭하여 편집 가능, 테이블 뷰에도 컬럼 추가
- [x] **레이아웃별 뷰**:
  - 레이아웃 번호로 그룹핑 → 각 그룹 안에 해당 씬 카드/테이블 나열
  - 레이아웃 헤더에 해당 그룹 진행률 표시
  - 예: `레이아웃 #1 — a001, a004 (진행률 75%)`
- [x] **씬번호별 뷰**: 기존 씬번호 순서대로 플랫하게 나열 (현재 방식)
- [x] **뷰 전환 토글**: 상단 바에 `씬번호별` / `레이아웃별` 아이콘 토글

```
데이터 구조 변경:
  Scene {
    ...existing,
    layoutId: string;  // 쉼표 구분: "a001, a008, a009"
  }

파싱 로직:
  layoutId.split(',').map(s => s.trim()).filter(Boolean)
  → ['a001', 'a008', 'a009'] 각각 클릭 가능한 태그
```

### 1-3. 씬번호 입력 개선 `P1` `[완료]`

> 난이도: ●●○ | 참고: 드롭다운 기반 입력으로 오타 방지

- [x] **접두사 드롭다운**: `a` / `b` / `c` / `d` / `sc` 등 알파벳 프리픽스 선택
- [x] **자동 번호 제안**: 선택된 프리픽스의 기존 번호 중 빈 번호를 자동 입력
  - 예: a001, a002, a004 존재 시 → 다음 제안값 `a003`
- [x] **수동 번호 입력**: 드롭다운 옆 숫자 입력 필드 (제안값이 기본 채워짐)
- [x] **중복 검사**: 이미 존재하는 씬번호 입력 시 경고 + 추가 버튼 비활성화
- [x] **연속 입력 지원**: 추가 후 폼 유지, 다음 번호 자동 채움, Enter/Esc 키보드 지원

### 1-4. 버전 표기 시스템 `P1` `[완료]`

> 난이도: ●○○ | 빠른 구현 가능

- [x] **package.json 버전 활용**: `version` 필드를 `__APP_VERSION__`으로 Vite define
- [x] **사이드바 하단 표기**: `[TEST]` 모드 표시 아래에 `v0.1.0` 표기
- [ ] **업데이트 시 자동 증가**: 빌드/배포 시 버전 태그 갱신
- [ ] **변경 내역 표시**: 설정 뷰에서 최근 업데이트 내역 확인 가능

```
표시 위치:
  사이드바 하단
  ┌─────────────┐
  │  ...메뉴...   │
  │              │
  │  [TEST]      │
  │  v1.2.0      │
  └─────────────┘
```

---

## Phase 2: 이미지 확인 및 리뷰 시스템 `[완료]`

> **목표**: BG 작업 특성상 이미지 확인이 필수. 씬 카드에서 바로 이미지를 보고 비교할 수 있게.
> **영향도**: BG 아티스트와 감독의 리뷰 워크플로우 혁신.
> **완료일**: 2026-02-20

### 2-1. 씬 이미지 업로드 및 미리보기 `P2` `[완료]`

> 난이도: ●●● | 참고: Kitsu 클립보드 붙여넣기, ftrack 드래그&드롭

- [x] **이미지 타입 2종**: 스토리보드 이미지 + 가이드(예시) 이미지
- [x] **업로드 방식 3종**:
  - 클립보드 붙여넣기 (`Ctrl+V`) — 카드에 포커스 후 붙여넣기
  - 드래그 & 드롭 — 파일을 카드 위에 드래그 (파란색 오버레이)
  - 파일 선택 다이얼로그 — SB/가이드 버튼 클릭
- [x] **씬 카드 썸네일**: 작은 미리보기 표시 (스토리보드/가이드 나란히)
- [x] **확대 보기**: 클릭 시 모달로 원본 크기 이미지 표시
- [x] **이미지 저장 전략**:
  - 로컬 저장: `%APPDATA%/Bflow-BGonly/images/{sheetName}/` 디렉토리
  - `local-image://` 커스텀 프로토콜로 렌더러에서 표시
  - 파일 경로를 `storyboardUrl`/`guideUrl` 필드에 저장

### 2-2. 이미지 비교 뷰 `P2` `[완료]`

> 난이도: ●●○ | 참고: ftrack 오버레이 비교, Kitsu 사이드바이사이드

- [x] **사이드 바이 사이드**: 스토리보드 vs 가이드 이미지 병렬 표시
- [x] **오버레이 비교**: 두 이미지를 겹쳐 놓고 불투명도 슬라이더로 전환
- [x] **확대/축소**: 줌 인/아웃 버튼 (25% 단위, 25%~400%)
- [ ] **버전 비교**: 같은 씬의 이전 버전과 현재 버전 비교 (향후)

### 2-3. 진행률 100% 완료 인터랙션 `P2` `[완료]`

> 난이도: ●○○ | 참고: Asana 완료 축하 애니메이션

- [x] **씬 완료 애니메이션**: 4단계 모두 체크 시 카드에 컨페티 파티클 효과 (framer-motion)
- [ ] **파트 완료 축하**: 파트 내 모든 씬 완료 시 프로그레스 바에 빛나는 효과 (향후)
- [ ] **에피소드 완료 마일스톤**: 에피소드 전체 완료 시 화면 전체 축하 애니메이션 (향후)
- [ ] **설정에서 토글 가능**: 개인 설정에서 on/off (향후)

---

## Phase 3: 알림 및 협업 시스템

> **목표**: 팀원 간 커뮤니케이션을 앱 안에서 해결. 슬랙과 연동하여 알림 흐름 구축.
> **영향도**: 감독 ↔ 아티스트 간 리뷰 요청/피드백 루프 자동화.

### 3-1. 태그 및 확인요청 버튼 `P3`

> 난이도: ●●○

- [ ] **확인요청 버튼**: 씬 카드에 "확인요청" 버튼 추가
  - 클릭 → 해당 씬의 상태가 "검수 대기"로 변경
  - 담당 감독에게 알림 발송 (앱 내 + 슬랙)
- [ ] **태그 시스템**: 씬에 태그 추가 가능 (`수정필요`, `참고`, `급함` 등)
  - 미리 정의된 태그 + 커스텀 태그
  - 태그별 색상 구분
- [ ] **이름 입력 후 태그 시 알림**: 담당자 변경 또는 태그 시 해당 인원에게 알림

### 3-2. 슬랙 웹훅 연동 `P3`

> 난이도: ●●● | 참고: Kitsu 네이티브 Slack 연동

- [ ] **슬랙 Incoming Webhook 설정**: 설정 뷰에서 웹훅 URL 입력
- [ ] **알림 트리거 설정**:
  - 확인요청 시 → 슬랙 채널에 메시지 발송
  - 태그 시 → 해당 사용자에게 DM 또는 멘션
  - 씬 상태 변경 시 → 채널 알림 (선택 가능)
- [ ] **슬랙 워크플로 연동**: 슬랙 워크플로 빌더와 연계 가능한 페이로드 포맷
- [ ] **알림 메시지 포맷**:

```
📋 BG 확인요청
• 에피소드: EP.03  파트: B
• 씬: a015  담당자: 김하늘
• 요청자: 원동우
• 상태: 완료 → 검수 대기
[앱에서 확인하기]
```

```
UX 참고:
- Kitsu: 사용자별 Slack/Discord 토글 (개인 프로필에서 설정)
- ftrack: @멘션 → 알림 자동 발송 (버전 제작자 자동 포함)
- 핵심: 상태 변경 → 알림이 자동이어야 함. 수동 알림은 잊힘.
```

---

## Phase 4: 뷰 확장 (에피소드 / 캘린더 / 인원별)

> **목표**: 대시보드 외 추가 뷰를 구현하여 다각도 현황 파악 가능하게.
> **영향도**: 감독과 PD가 전체 프로덕션을 한눈에 파악.

### 4-1. 에피소드별 현황 뷰 `P4` `[완료]`

> 난이도: ●●○ | 완료일: 2026-02-21

- [x] **에피소드 카드 그리드**: 각 에피소드를 카드로 표시
  - 에피소드 번호, 전체 진행률 (그라데이션 바), 파트별 미니 매트릭스
  - 부서별 진행률 분리 표시 (BG/ACT)
  - 클릭 → 해당 에피소드의 씬 목록 뷰로 이동
- [x] **파트별 매트릭스**: 에피소드 × 파트 테이블 (셀: 진행률 % 색상 코딩)
- [x] **카드/매트릭스 뷰 토글**: 상단 토글로 뷰 전환
- [ ] **타임라인 바**: 에피소드별 작업 기간 + 완료 예상일 (향후)

### 4-2. 프로젝트 타임라인 뷰 `P4` `[완료]`

> 난이도: ●●● | 완료일: 2026-02-21

- [x] **간트 차트**: 에피소드/파트별 진행률 가로 바 시각화
  - 에피소드 접기/펼치기, 부서별 색상 구분
  - 애니메이션 진입 효과
- [x] **히트맵 뷰**: 에피소드×파트 매트릭스 히트맵 (진행률 색상 코딩)
- [x] **전체 프로젝트 진행률 바**: 상단에 전체 통합 프로그레스
- [x] **간트/히트맵 뷰 토글**
- [ ] **월간/주간 캘린더**: 마감일 기반 캘린더 뷰 (마감일 데이터 추가 시)
- [ ] **마감일 경고**: D-3, D-1 시 색상 변경 (향후)
- [ ] **대시보드 위젯**: 메인 대시보드에 미니 캘린더 위젯 추가 (향후)

```
UX 참고:
- Kitsu: 예상 작업시간 + 시작일 입력 → 간트 자동 생성, "지연=빨강" 모드
- ftrack: 타임라인 줌 핸들로 날짜 범위 확대/축소
- ShotGrid: 간트 + 리소스 플래닝 뷰 (과할 수 있으므로 간트만 우선)
```

### 4-3. 인원별 태스크 뷰 `P4` `[완료]`

> 난이도: ●●○ | 완료일: 2026-02-21

- [x] **인원별 카드 그리드**: 담당자별 카드 표시
  - 원형 프로그레스 링 (진행률)
  - 부서별 분포 뱃지 (BG/ACT 각 씬 수)
  - 4단계 바 (LO/완료/검수/PNG)
- [x] **씬 목록 펼치기**: 카드 내 토글로 해당 담당자 씬 목록 표시
  - 진행률 오름차순 정렬, 미니 프로그레스 바
  - 씬 클릭 시 해당 에피소드/파트 씬 뷰로 이동
- [x] **정렬 옵션**: 이름순, 씬 수순, 진행률순 + 오름/내림차순
- [ ] **생산성 지표 (선택)**: 주간 완료 씬 수 추이 (향후)

```
UX 참고:
- ftrack: My Tasks가 로그인 후 첫 화면, 칸반 + 활동 피드 + 다가오는 마감
- Kitsu: 인원별 일일 쿼터 (목표 씬 수 대비 실제 완료 수)
```

### 4-4. 메인 대시보드 강화 `P4`

> 난이도: ●●○

- [ ] **담당자별 세부 진행률**: 현재는 씬 완성 시에만 % 반영 → 단계별 세분화
  - 예: 김하늘 — LO: 80%, 완료: 60%, 검수: 40%, PNG: 20% → 종합: 50%
- [ ] **미니 캘린더 위젯**: 대시보드에 이번 주/다음 주 마감일 표시
- [ ] **최근 활동 피드**: "원동우가 EP03_B a015의 LO를 완료" 등 실시간 로그

---

## Phase 5: 커스터마이징 및 확장성

> **목표**: 프로젝트별 / 팀별 맞춤 설정 가능하게. 향후 파이프라인 변경에 유연하게 대응.
> **영향도**: 장기적 유지보수성과 다른 프로젝트 재활용성 확보.

### 5-1. 커스텀 파이프라인 단계 `P5`

> 난이도: ●●● | 참고: ftrack 워크플로 스키마, Kitsu 시맨틱 상태 플래그

현재 `LO → 완료 → 검수 → PNG` 4단계 고정 → 커스텀 단계 추가/제거 가능하게.

- [ ] **단계 설정 UI**: 설정 뷰에서 단계 추가/삭제/순서 변경
  - 각 단계: 이름, 색상, 시맨틱 플래그 (IS_DONE, IS_FEEDBACK_REQUEST 등)
- [ ] **동적 열 생성**: Google Sheets에 새 열 자동 추가 (GAS에서 처리)
- [ ] **기존 데이터 호환**: 새 단계 추가 시 기존 씬은 해당 단계가 `false`로 초기화
- [ ] **타입 시스템 업데이트**: Stage 타입을 고정 유니온 → 동적 배열로 변경

```
데이터 구조 변경:
  현재: Stage = 'lo' | 'done' | 'review' | 'png'  (하드코딩)
  변경: stages: StageConfig[] = [
    { id: 'lo', label: 'LO', color: '#74B9FF', order: 0 },
    { id: 'done', label: '완료', color: '#A29BFE', order: 1 },
    ...커스텀 단계 추가 가능
  ]

UX 참고:
- ftrack: 워크플로 스키마 → 프로젝트별 다른 단계 세트 할당 가능
- Kitsu: IS_DONE, IS_DEFAULT, IS_FEEDBACK_REQUEST 등 시맨틱 플래그로 동작 제어
```

### 5-2. 동기화 최적화 `P5`

> 난이도: ●●○

- [ ] **폴링 주기 설정**: 설정에서 30초 / 1분 / 3분 / 5분 선택 가능
  - 기본값: 1분 (GAS 일일 실행 한도 고려)
  - GAS 무료 한도: ~20,000회/일 → 20명 × 1분 폴링 = ~28,800회/일 (주의 필요)
- [ ] **diff 기반 업데이트**: 전체 재렌더링 대신 변경된 씬만 업데이트
- [ ] **변경 감지 해시**: 서버 응답에 해시 포함 → 변경 없으면 UI 업데이트 스킵
- [ ] **앱 포커스 기반 폴링**: 앱이 포커스 상태일 때만 빈번하게, 백그라운드에서는 느리게

```
GAS 리소스 계산:
  20명 × 60분/시간 × 8시간/일 = 9,600회/일 (1분 주기)
  20명 × 30분/시간 × 8시간/일 = 4,800회/일 (2분 주기)
  → 1분 주기도 GAS 무료 한도(20,000) 이내. 안전.

최적화 전략:
  1. ETag/해시 기반: 변경 없으면 UI 스킵 (네트워크 비용만)
  2. 포커스 기반: 백그라운드 앱은 5분 주기로 전환
  3. 낙관적 업데이트: 이미 적용 완료 (현재 구현)
```

---

## Phase 6: 멀티 부서 확장 — BG + 액팅 + 컴포지팅 `[진행]` `[중요]`

> **목표**: 현재 BG 전용 앱을 BG + 액팅 + 컴포지팅까지 통합 관리 가능한 프로덕션 현황 도구로 확장한다.
> **영향도**: 앱의 근본적 아키텍처 확장. 프로젝트 전체를 한 곳에서 관리하는 핵심 전환점.
> **상태**: Step 1~4 완료 (Step 5 컴포지팅 대기)
> **착수 결정**: 2026-02-21 — Phase 3~5를 건너뛰고 Phase 6 우선 진행 결정

### 핵심 데이터 계층 구조

```
프로젝트 (Project)
 └─ 에피소드 (EP01, EP02, EP03, ...)
     └─ 파트 (A, B, C, ... — 파트별로 나뉠 시)
         ├─ BG (배경)
         │   └─ BG 씬 목록 (a001, a002, b001, ...)
         │       └─ 단계: LO → 완료 → 검수 → PNG (현재 4단계)
         │
         ├─ 액팅 (Acting)
         │   └─ 액팅 씬 목록 (a001, a002, b001, ...)
         │       └─ 단계: 미정 (4~5단계, 커스텀 가능)
         │
         └─ 컴포지팅 (Compositing) — 향후 결정
             └─ 관리 범위/방식 미정
```

**핵심 포인트**: 같은 씬번호(예: `a001`)가 BG와 액팅 양쪽에 존재하며, 각 부서별로 독립적인 진행률을 관리한다.

### 6-1. 부서(Department) 개념 도입 `P6` `[완료]`

> 난이도: ●●● | 앱 전체 아키텍처에 영향

- [x] **Department 타입 추가**: `'bg' | 'acting'` (types/index.ts:3)
  - `DEPARTMENT_CONFIGS` 레코드로 부서별 설정 관리 (types/index.ts:17-34)
  - `Scene`에 `department` 필드, `Part`에 `department`+`sheetName` 필드
- [x] **부서별 파이프라인 단계**: 각 부서마다 다른 단계 라벨/색상
  - BG: LO / 완료 / 검수 / PNG (#74B9FF, #A29BFE, #FDCB6E, #00B894)
  - 액팅: 1원화 / 2원화 / 동화 / 최종 (#FF6B6B, #FF9FF3, #FECA57, #48DBFB)
- [x] **부서 전환 UI**: ScenesView 상단 탭 (전체 | BG | ACT)
  - 애니메이션 슬라이딩 인디케이터, 부서별 컬러
  - `useAppStore.selectedDepartment`로 상태 관리
- [x] **씬 카드에 부서 표시**: 통합 뷰에서 "BG 섹션" / "ACT 섹션" 분리 표시

```
타입 변경:
  type Department = 'bg' | 'acting' | 'compositing';

  interface Scene {
    ...existing,
    department: Department;  // 어느 부서의 씬인지
  }

  interface StageConfig {
    id: string;
    label: string;
    color: string;
    order: number;
  }

  interface DepartmentConfig {
    id: Department;
    label: string;           // '배경', '액팅', '컴포지팅'
    stages: StageConfig[];   // 부서별 파이프라인 단계
    color: string;           // 부서 구분 컬러
  }

UI 전환:
  ┌─────────────────────────────────────┐
  │  EP03 · B파트                        │
  │  ┌─────┐ ┌─────┐ ┌──────────┐      │
  │  │ BG  │ │ 액팅 │ │ 컴포지팅  │      │
  │  └─────┘ └─────┘ └──────────┘      │
  │  ─────────────────────────────      │
  │  [씬 목록: 선택된 부서의 씬들]        │
  └─────────────────────────────────────┘
```

### 6-2. 데이터 소스 구조 설계 `P6`

> 난이도: ●●○ | 미정 사항 — 아래 추천안 참고

**현재 상태**: BG만 관리, 시트 이름 `EP{n}_{part}` (예: `EP03_B`)

**⚠️ 미정 사항**: 스프레드시트 구조를 어떻게 할 것인가?

#### 추천안: 프로젝트당 1개 스프레드시트 + 시트 이름 확장

에피소드당 100~150컷 기준, 아래 구조 추천:

```
[스프레드시트 1개 = 프로젝트 1개]

시트 이름 규칙: EP{n}_{part}_{dept}
  EP03_B_BG    ← EP03 B파트 배경 씬 (현재 EP03_B에 해당)
  EP03_B_ACT   ← EP03 B파트 액팅 씬
  EP03_C_BG    ← EP03 C파트 배경 씬
  EP03_C_ACT   ← EP03 C파트 액팅 씬
  ...

하위 호환: 기존 EP03_B → EP03_B_BG로 매핑 (또는 _BG 없으면 BG로 간주)
```

- [x] **시트 이름 파싱 확장**: `EP{n}_{part}` → `EP{n}_{part}_{dept}`
  - `parseDepartmentFromSheetName()` (sheets.ts:261-267) — `_ACT` → acting, 기본 → bg
  - GAS: `EP_PATTERN = /^EP(\d+)_([A-Z])(?:_(BG|ACT))?$/` (Code.gs:47)
- [x] **스프레드시트 구조 결정**: 옵션 A 채택 — 프로젝트당 1개 스프레드시트
  - `EP03_B_BG`, `EP03_B_ACT` 형태로 시트 이름 확장

```
규모 추정 (옵션 A 기준):
  에피소드당: ~150컷 × 2부서 = ~300행
  20 에피소드: ~6,000행 (스프레드시트 제한 500만 셀 대비 매우 여유)
  시트 수: 20 EP × 3~4 파트 × 2 부서 = ~160 시트 (충분히 관리 가능)
  → 프로젝트당 1개로 충분
```

### 6-3. 대시보드 멀티 부서 위젯 `P6` `[완료]`

> 난이도: ●●○

- [x] **BG 진행 현황 위젯**: OverallProgressWidget + `dashboardDeptFilter='bg'`
- [x] **액팅 진행 현황 위젯**: 동일 위젯 + `dashboardDeptFilter='acting'`
- [x] **에피소드 통합 진행률**: EpDeptComparisonWidget — BG vs ACT 나란히 비교
- [x] **프로젝트 전체 진행률**: DepartmentComparisonWidget (수평/수직 바, 도넛 차트 전환 가능)
  - 대시보드 "통합" 탭에서 BG+ACT 합산 진행률 표시

```
위젯 계층 구조:

  ┌─ 프로젝트 진행률 ──────────┐
  │  ████████████░░░░ 62%     │
  │  (12개 EP 평균)            │
  └───────────────────────────┘
           ▲ 합산
  ┌─ EP03 통합 ────────────────┐
  │  BG:  ████████░░░ 72%     │
  │  액팅: ██████░░░░░ 52%     │
  │  통합: ███████░░░░ 62%     │
  └───────────────────────────┘
           ▲ 합산
  ┌─ BG 진행률 ─┐  ┌─ 액팅 진행률 ─┐
  │  72%        │  │  52%          │
  │  (기존)     │  │  (신규)       │
  └─────────────┘  └───────────────┘
```

### 6-4. 액팅 씬 관리 `P6` `[완료]`

> 난이도: ●●○ | 기존 BG 씬 관리 로직을 부서별로 확장

- [x] **액팅 씬 추가/삭제**: BG와 동일한 UX, 부서 파라미터만 다름
  - 씬번호 중복 검사는 같은 부서 내에서만 수행
- [x] **액팅 씬 카드/테이블**: SceneCard가 `deptConfig.stageLabels/stageColors`로 동적 렌더링
  - BG: LO, 완료, 검수, PNG / 액팅: 1원화, 2원화, 동화, 최종
- [x] **액팅 이미지**: 액팅 씬도 이미지 업로드/비교 지원 (동일 인프라 재사용)
- [x] **통합 씬 뷰**: `selectedDepartment='all'`에서 BG + ACT 섹션 분리 표시
  - `allModeScenes`로 양 부서 병합, `selectionId` 접두사로 라쏘 선택 구분

```
통합 뷰 (예시):
  씬번호 │ BG 진행률        │ 액팅 진행률
  ───────┼─────────────────┼─────────────────
  a001   │ ████ 100% ✅    │ ███░ 75%
  a002   │ ██░░ 50%        │ █░░░ 25%
  a003   │ ░░░░ 0%         │ ██░░ 50%
```

### 6-5. 컴포지팅 (향후 결정) `P6`

> 난이도: 미정 | BG + 액팅 완료 후의 합성 단계

- [ ] **관리 범위 결정**: (추후 확정 필요)
  - 옵션 A: 씬별 완료/미완료 체크만
  - 옵션 B: 별도 관리 불필요 (BG+액팅만으로 충분)
  - 옵션 C: 컴포지팅 전용 단계/워크플로우
- [ ] **대시보드 반영**: 컴포지팅 관리 시 프로젝트 진행률에 포함

```
구현 순서:
  Step 1: 부서 개념 도입 (타입 시스템 + UI 전환) ← ✅ 완료
  Step 2: 데이터 소스 구조 확장 (시트 이름 + GAS) ← ✅ 완료
  Step 3: 액팅 씬 관리 (BG 로직 확장 재사용) ← ✅ 완료
    + toggleSceneStage 버그 수정 (partId→sheetName 기반 식별)
  Step 4: 대시보드 멀티 부서 위젯 ← ✅ 완료
    + DepartmentComparisonWidget (BG vs ACT 비교)
    + 대시보드 "통합" 탭 (dashboardDeptFilter)
    + 에피소드 요약 부서별 분리 뷰
  Step 5: 컴포지팅 (필요 시) ← 향후 결정

  ※ 액팅 파이프라인 단계는 초기에 4단계 하드코딩 후,
     Phase 5-1(커스텀 단계)에서 동적으로 변경 가능하게 확장 예정.
```

---

## Phase 7: 대시보드 UX 혁신 & UI 폴리시

> **목표**: 대시보드를 위젯 기반 커스터마이징 가능한 OS 수준 UX로 끌어올리고, 앱 전체의 시각적 통일성과 세련된 느낌을 확보한다.
> **영향도**: 일상 사용 경험의 질적 도약. 바탕화면 위젯으로 앱을 안 열고도 현황 파악 가능.

### 7-1. 대시보드 위젯 레이아웃 편집 `P7` `[완료]`

> 난이도: ●●● | 완료일: 2026-02-21

- [x] **레이아웃 편집 모드**: "레이아웃 편집" 버튼 클릭 시 진입
  - 모든 위젯이 **iPhone 스타일로 부들부들(wiggle) 흔들림** 애니메이션
  - `@keyframes widget-wiggle` CSS 주입, 위젯마다 다른 딜레이로 자연스러운 떨림
  - 각 위젯 좌상단에 빨간 `×` 삭제 버튼
- [x] **위젯 추가/제거**: 편집 모드에서 위젯 제거 + "위젯 추가" 팝오버
  - 글래스모피즘 팝오버 (숨겨진 위젯 목록)
  - 드래그로 위치 변경 + 모서리 드래그로 크기 변경 (react-grid-layout)
- [x] **레이아웃 저장**: 위젯 배치/크기를 로컬 JSON으로 자동 저장
- [x] **편집 완료**: "완료" 버튼 클릭 시 wiggle 멈추고 레이아웃 고정
- [x] **편집 모드 안내**: 하단에 드래그/크기 조절 안내 텍스트
- [ ] **위젯 내 스크롤바 제거**: 콘텐츠 자동 축약 (향후)

```
UX 참고:
- iOS: 앱 아이콘 길게 눌러 편집 모드 → 흔들리면서 ×버튼 표시
- Windows 위젯 보드: 위젯 추가/크기 변경/재배치
- 핵심: 편집 모드 진입/퇴출이 명확하고, 위젯 조작이 직관적이어야 함
```

### 7-2. 데스크탑 AOT 플로팅 위젯 `P7` `[진행]`

> 난이도: ●●● | 참고: Windows 위젯, macOS 데스크탑 위젯, Rainmeter

- [x] **위젯 팝아웃 기능**: WidgetPopup.tsx (635줄) — 별도 Electron BrowserWindow로 분리
  - `alwaysOnTop` 토글, `frame: false`, `transparent: true`
  - 7개 위젯 팝아웃 가능 (overall-progress, stage-bars, assignee-cards, episode-summary, dept-comparison, calendar, my-tasks)
- [x] **글래스모피즘 디자인**: Windows Acrylic 네이티브 블러 + CSS glass tint
  - `appOpacity` + `glassIntensity` 설정 가능
- [x] **프레임리스 윈도우**: 타이틀바 없이 위젯만 표시
  - 상단 핸들 바 (드래그 영역)
  - 독 모드: 최소화→플로팅 아이콘 바, 호버 시 확장 (morphing 트랜지션)
- [x] **위젯 선택**: 대시보드에서 위젯별 팝아웃 버튼, 실시간 데이터 동기화 유지
- [ ] **위치/크기 기억**: 팝아웃 위젯의 화면 위치와 크기를 앱 종료 후에도 저장/복원 (미구현, 0-6과 연계)

```
Electron 구현:
  const widgetWin = new BrowserWindow({
    width: 320, height: 240,
    alwaysOnTop: true,
    frame: false,
    transparent: true,
    resizable: true,
    skipTaskbar: true,  // 작업표시줄에 안 보임
    webPreferences: { ... }
  });
  widgetWin.loadURL(`app://widget?type=progress`);

디자인:
  ┌─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─┐   ← 유리 효과, 프레임 없음
  │  ≡ 전체 진행률          │   ← 상단 핸들 (드래그 영역)
  │  ████████░░░░ 67%      │
  │  EP03 B파트 — 12/18 씬  │
  │  💬 화이팅! 거의 다 왔어! │
  └─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─┘
```

### 7-3. 진행률 동기부여 메시지 `P7` `[완료]`

> 난이도: ●○○ | 참고: Duolingo 격려 메시지, 게임 업적 시스템

- [x] **진행률 구간별 랜덤 메시지**: 전체 진행률 위젯 하단에 표시
  - `0%` — "시작이 반이에요! 화이팅!", "첫 발을 내딛었습니다!", "빈 캔버스가 가장 설레는 순간!"
  - `1~10%` — "씨앗을 심었어요, 잘 자랄 거예요!", "시작이 좋습니다!"
  - `10~20%` — "이때가 제일 성과가 안 보이지만, 지금 땅을 단단히 다지는 중!", "기초 공사 중... 곧 올라갑니다!"
  - `20~40%` — "슬슬 속도가 붙기 시작합니다!", "꾸준함이 최고의 무기!"
  - `40~60%` — "절반 지났어요! 페이스 유지!", "반환점을 돌았습니다, 이제 내리막길!"
  - `60~80%` — "끝이 보이기 시작합니다!", "마무리가 중요해요, 집중!"
  - `80~99%` — "거의 다 왔어요! 라스트 스퍼트!", "손에 잡힐 듯! 조금만 더!"
  - `100%` — "완벽합니다! 수고하셨습니다!", "모든 씬 완료! 대단해요!"
- [x] **메시지 풀(Pool)**: 각 구간별 3개 메시지 (명언 + 저자 표기), 랜덤 선택
  - 같은 메시지가 연속으로 뜨지 않도록 이전 메시지 기억
- [x] **애니메이션**: 8초 간격 로테이션, framer-motion fade-in/out + 슬라이드 트랜지션
- [ ] **커스텀 메시지 추가 가능**: 설정에서 직접 메시지 추가/편집 (향후)

```
위젯 디자인:
  ┌───────────────────────┐
  │  전체 진행률            │
  │  ████████████░░░ 67%  │
  │                       │
  │  "끝이 보이기 시작합니다! │
  │   마무리가 중요해요 💪"  │
  └───────────────────────┘
```

### 7-4. 전체 UI 통일성 & 세련된 폴리시 `P7` `[완료]`

> 난이도: ●●○ | 참고: Linear, Notion, Arc Browser

- [x] **위젯 공통 스타일 통일**: hover shadow, border 전환, 일관된 ease-out 200ms
- [x] **트랜지션 통일**: 모든 진행률 바 `duration-700 ease-out`, 호버 `duration-200 ease-out`
- [x] **대시보드 탭 애니메이션**: framer-motion layoutId 기반 슬라이딩 인디케이터
- [x] **탭 전환 시 페이드**: AnimatePresence로 위젯 영역 부드러운 전환
- [x] **글래스모피즘 툴팁**: 부서별 비교 위젯 막대 hover 시 글래스 효과 툴팁
- [x] **마이크로 인터랙션**: 담당자 카드/에피소드 카드 hover 시 배경+보더 전환
- [ ] **다크 모드 최적화**: 현재 다크 테마 컬러의 대비·가독성 재점검 (향후)

```
폴리시 체크리스트:
  □ 사이드바 hover/active 상태 일관성
  □ 카드 hover shadow 통일
  □ 폼 input focus ring 색상 통일
  □ 버튼 variant (primary/secondary/ghost) 정리
  □ 빈 상태(empty state) 일러스트 + 안내 문구
  □ 로딩 스켈레톤 (Shimmer) 적용
  □ 토스트/알림 디자인 통일
```

### 7-5. 스포트라이트 검색 `P7` `[완료]`

> 난이도: ●●● | 완료일: 2026-02-21

- [x] **Ctrl+Space 단축키**: 어디서든 스포트라이트 검색창 호출
  - window keydown 이벤트 리스너, ESC로 닫기
- [x] **검색 UI 애니메이션**:
  - 배경: `backdrop-filter: blur(12px)` + `rgba(0,0,0,0.45)` 오버레이
  - 검색창 위에서 아래로 스케일 + 페이드 진입 (커스텀 ease 커브)
  - 글래스모피즘 컨테이너: `rgba(26,29,39,0.88)` + inset glow
- [x] **검색 대상**: 앱 내 모든 데이터 퍼지 검색
  - 씬번호, 담당자 이름, 메모 내용, 에피소드/파트
  - 빈 쿼리 시 빠른 액션 표시 (대시보드/씬/에피소드/인원별 이동)
- [x] **검색 결과 UI**:
  - 카테고리별 그룹핑 (씬, 담당자, 에피소드, 메모, 빠른 액션)
  - 키보드 ↑↓ 선택 + Enter로 이동, 마우스 호버 연동
  - 미니 프로그레스 바 + 퍼센트 표시
  - 하단 키보드 힌트
- [x] **퍼지 검색**: 부분일치 + character-by-character fuzzy matching
  - 점수 기반 정렬 (exact > startsWith > includes > fuzzy)

```
검색 UI:
  ┌─────────────────────────────────────────┐
  │ 🔍 검색...                    ⌘ Space   │  ← 글래스 효과 검색 바
  ├─────────────────────────────────────────┤
  │ 씬                                      │
  │   📋 a015 — EP03 B파트 (김하늘)    67%  │
  │   📋 a016 — EP03 B파트 (원동우)    33%  │
  │ 담당자                                   │
  │   👤 김하늘 — 12씬 담당 (평균 58%)      │
  │ 메모                                    │
  │   📝 "배경 수정필요" — a003             │
  └─────────────────────────────────────────┘
       ↑ 뒤에 블러 + 어두운 오버레이
```

---

## Phase 8: 설정 개인화 `[진행]`

> **목표**: 사용자별 맞춤 설정 경험 제공 — 글꼴 크기, 단축키, 애니메이션, 시작 화면, 로그인 유지
> **배경**: 기존 설정 탭은 테마/시트 연동만 존재. VS Code/Figma 스타일 좌측 서브탭 레이아웃으로 확장.
> **전략**: CSS 변수 기반 타이포그래피 시스템으로 기존 컴포넌트 변경 없이 전체 글꼴 스케일링.
> **참고**: `DEVLOG/2026-02-27_설정탭-로드맵.md` — 상세 구현 계획

### 8-0. 설정 탭 리팩토링 (좌측 서브탭 구조) `P8` `[완료]`

> 난이도: ●●○ | 완료일: 2026-02-27

- [x] **SettingsView 분리**: 모놀리식 345줄 → 좌측 서브탭 + 우측 콘텐츠 셸 (~80줄)
- [x] **SettingsSidebar 생성**: 8개 탭 (외관/글꼴/단축키/효과/시작/로그인/연동/안내), disabled 탭 "예정" 뱃지
- [x] **섹션 컴포넌트 분리**: ThemeSection, SheetsSection, GuideSection 추출
- [x] **SettingsSection 래퍼**: 글래스모피즘 카드 + 아이콘/타이틀/액션 슬롯

```
파일 구조:
  src/components/settings/
    SettingsSidebar.tsx     — 좌측 네비게이션 (lucide-react 아이콘)
    SettingsSection.tsx     — 재사용 섹션 래퍼
    ThemeSection.tsx         — 색상 테마 + 다크/라이트 모드
    SheetsSection.tsx        — Google Sheets 연동
    GuideSection.tsx         — 사용 안내
    FontSizeSection.tsx      — 글꼴 크기 설정 (8-1)
  src/views/SettingsView.tsx — 레이아웃 셸 (리팩토링됨)
```

### 8-1. 글꼴 크기 커스터마이징 `P8` `[완료]`

> 난이도: ●●● | 완료일: 2026-02-27
> 핵심: CSS 변수 `--text-scale` 곱셈 방식으로 기존 334개+ Tailwind 클래스 변경 없이 전역 스케일링

- [x] **CSS 변수 시스템**: `index.css`에 `--text-scale`, `--text-heading-scale` 등 5개 변수 정의
- [x] **Tailwind 오버라이드**: `.text-xl`, `.text-sm` 등 + `[class*="text-[11px]"]` 브래킷 크기 선택자
- [x] **typography.ts 유틸**: `FontScale` 타입, 5단계 프리셋, `applyFontSettings()` 함수
- [x] **FontSizeSection UI**: 프리셋 5단계 세그먼트 + 실시간 미리보기 패널 + 카테고리별 슬라이더 (고급)
- [x] **영속화**: `preferences.json`에 `fontScale` + `fontCategoryScales` 저장/로드
- [x] **FOUC 방지**: `App.tsx` init에서 테마보다 먼저 글꼴 설정 적용

```
프리셋:
  xs=0.85 (아주 작게) | s=0.92 (작게) | m=1.00 (보통, 기본값)
  l=1.10 (크게) | xl=1.20 (아주 크게)

카테고리별 개별 조절 (고급 설정, 범위 0.8~1.4):
  heading  — 제목 (text-xl, text-lg)
  body     — 본문 (text-sm, text-base, text-[13px])
  caption  — 캡션 (text-xs, text-[12px])
  micro    — 마이크로 (text-[11px]~text-[7px])
```

### 8-2. 키보드 단축키 커스텀 `P8` `[ ]`

> 난이도: ●●○ | 상태: 대기
> 참고: VS Code 키바인딩 에디터

- [ ] **shortcuts.ts**: 단축키 타입/기본값 정의 (15개+)
- [ ] **shortcutManager.ts**: 중앙 매니저 (등록/해제/리바인딩/충돌 감지)
- [ ] **ShortcutsSection.tsx**: VS Code 스타일 키바인딩 에디터 (녹음 모드 + 충돌 경고)
- [ ] **기존 핸들러 마이그레이션**: App.tsx + SpotlightSearch.tsx 인라인 핸들러 → shortcutManager

### 8-3. 플렉서스 애니메이션 제어 `P8` `[완료]`

> 난이도: ●●○ | 완료일: 2026-02-27
> 핵심: 로그인/대시보드 플렉서스 토글 + 파티클 수 + 세부 설정 (속도/마우스/글로우/연결 거리)
> 미리보기: 마우스 인터랙션 + 부드러운 파티클 증감 (재생성 아님)

- [x] **EffectsSection.tsx**: 로그인/대시보드 토글 + 파티클 수 슬라이더
- [x] **미니 플렉서스 프리뷰**: 마우스 반응, 부드러운 증감 (프레임당 3개), 설정 실시간 반영
- [x] **세부 설정 (접이식)**: 움직임 속도, 마우스 범위, 마우스 힘, 글로우 강도, 연결 거리
- [x] **useAppStore 확장**: plexusSettings에 speed/mouseRadius/mouseForce/glowIntensity/connectionDist 추가
- [x] **LoginScreen/Dashboard 연동**: 하드코딩 상수 → plexusCfgRef로 실시간 반영 (루프 재시작 없음)
- [x] **preferences.json 영속화**: 앱 재시작 시 복원
- [x] **항목별 개별 초기화**: 각 슬라이더/토글에 개별 리셋 버튼 + 전체 기본값 복원

### 8-4. 스플래시 건너뛰기 `P8` `[다음]`

> 난이도: ●○○ | 상태: 다음 착수 예정

- [ ] **StartupSection.tsx**: 로딩 스플래시 / 랜딩 스플래시 개별 토글
- [ ] **App.tsx 조건 분기**: skipLoadingSplash/skipLandingSplash boolean guard

### 8-5. 로그인 자동저장 `P8` `[다음]`

> 난이도: ●○○ | 상태: 다음 착수 예정

- [ ] **LoginSection.tsx**: "로그인 유지" 토글
- [ ] **LoginScreen 체크박스**: rememberMe 옵션 (기본값 true — 하위 호환)
- [ ] **세션 복원 로직**: rememberMe 체크 후 auth.json 복원 여부 결정

### 8-6. 온보딩 가이드 `P8` `[ ]`

> 난이도: ●●○ | 상태: 향후 계획

- [ ] **가이드 투어**: 사이드바 섹션 순회, 팝오버 설명
- [ ] **하이라이트**: box-shadow 오버레이 + 블러로 대상 외 영역 어둡게
- [ ] **상태 저장**: `onboardingCompleted` boolean → preferences.json
- [ ] **트리거**: 최초 로그인 자동 or 설정에서 수동 트리거

---

## 구현 우선순위 총정리

> **2026-02-27 기준**: Phase 0-1~0-3 완료. 나머지 안정화 + 미완료 기능 진행.
> Phase 1~2 완료, Phase 6 Step 1~4 완료, Phase 7-1~7-5 완료, Phase 8-0~8-1, 8-3 완료.

### Phase 0 (긴급 안정화) — 진행 현황

| 순위 | 항목 | 세부 | 난이도 | 상태 |
|------|------|------|--------|------|
| 1 | 0-1. 배치 엔드포인트 | GAS batch + 클라이언트 gasBatch() + 에피소드/파트 적용 | ●●○ | ✅ 완료 |
| 2 | 0-2. 낙관적 업데이트 롤백 보강 | 아카이브/삭제 실패 시 UI 복원 | ●○○ | ✅ 완료 |
| 3 | 0-3. 재시도 로직 | gasFetchWithRetry() 지수 백오프 + UI 토스트 | ●○○ | ✅ 완료 |
| 4 | 0-4. 테스트 모드 제거 | 코드 간소화 (선택적) | ●●○ | 검토 중 |
| 5 | 0-5. 종료 시 배치 큐 보장 | before-quit 훅 + 미완료 큐 처리 | ●●○ | ✅ 완료 |
| 6 | 0-6. 위젯 팝업 위치 저장 | 앱 재시작 시 위젯 위치/크기/AOT 복원 | ●●○ | ✅ 완료 |

### 완료된 항목 (Phase 1~2)

| 항목 | 페이즈 | 난이도 | 상태 |
|------|--------|--------|------|
| 버전 표기 시스템 | P1 | ●○○ | ✅ 완료 |
| 씬 목록 정렬/필터 개선 | P1 | ●●○ | ✅ 완료 |
| 씬번호 입력 개선 | P1 | ●●○ | ✅ 완료 |
| 레이아웃별 씬 그룹핑 | P1 | ●●● | ✅ 완료 |
| 이미지 업로드/미리보기 | P2 | ●●● | ✅ 완료 |
| 진행률 100% 애니메이션 | P2 | ●○○ | ✅ 완료 |
| 이미지 비교 뷰 | P2 | ●●○ | ✅ 완료 |

### Phase 6 (멀티 부서 확장) — Step 1~4 완료

| 순위 | 항목 | 세부 | 난이도 | 상태 |
|------|------|------|--------|------|
| 1 | **6-1. 부서(Department) 개념 도입** | 타입 시스템 + 부서 전환 UI | ●●● | ✅ 완료 |
| 2 | **6-2. 데이터 소스 구조 설계** | 시트 이름 확장 + GAS 업데이트 | ●●○ | ✅ 완료 |
| 3 | **6-4. 액팅 씬 관리** | BG 로직 확장 재사용 + 버그 수정 | ●●○ | ✅ 완료 |
| 4 | **6-3. 대시보드 멀티 부서 위젯** | BG+액팅+통합 진행률 | ●●○ | ✅ 완료 |
| 5 | **6-5. 컴포지팅** | 향후 결정 | 미정 | 대기 |

### 이후 진행 (Phase 3~5, 7)

| 순위 | 항목 | 페이즈 | 난이도 | 비고 |
|------|------|--------|--------|------|
| 1 | **재시도 중 UI 토스트** | P0 | ●○○ | 0-3 잔여 — 렌더러에 토스트 알림 |
| 2 | 동기화 최적화 | P5 | ●●○ | 폴링 주기 + diff 기반 업데이트 |
| 3 | 태그/확인요청 버튼 | P3 | ●●○ | 협업 핵심 (댓글 시스템 이미 구현) |
| 4 | 슬랙 웹훅 연동 | P3 | ●●● | 알림 자동화 |
| 5 | 커스텀 파이프라인 단계 | P5 | ●●● | 부서별 단계 커스텀 |
| 6 | 메인 대시보드 강화 | P4 | ●●○ | 세부 진행률 (4-4) |
| 7 | AOT 위젯 위치 저장 | P7 | ●●○ | 7-2 잔여 (0-6과 통합) |
| 8 | 컴포지팅 확장 | P6 | 미정 | 6-5 향후 결정 |
| 9 | **설정 탭 리팩토링** | P8 | ●●○ | 8-0 ✅ 완료 |
| 10 | **글꼴 크기 커스터마이징** | P8 | ●●● | 8-1 ✅ 완료 |
| 11 | **플렉서스 애니메이션 제어** | P8 | ●●○ | 8-3 ✅ 완료 |
| 12 | **스플래시 건너뛰기** | P8 | ●○○ | 8-4 다음 |
| 13 | **로그인 자동저장** | P8 | ●○○ | 8-5 다음 |
| 14 | 키보드 단축키 커스텀 | P8 | ●●○ | 8-2 대기 |

---

## 로드맵 외 추가 구현 기능 (미등록)

> 로드맵에는 없었지만 개발 과정에서 추가로 구현된 기능들.

| 기능 | 파일 | 설명 | 상태 |
|------|------|------|------|
| **인증/사용자 관리** | `useAuthStore.ts`, `components/auth/*` | 로그인, 비밀번호 변경, 관리자 모드, 사용자 CRUD | ✅ 완료 |
| **댓글 시스템** | `commentService.ts` (197줄) | 씬별 댓글 스레드, @멘션, Sheets `_COMMENTS` 탭 + 로컬 폴백 | ✅ 완료 |
| **캘린더 서비스** | `calendarService.ts` (81줄) | 이벤트 CRUD, 로컬 JSON 저장, 날짜 범위 필터 | ✅ 완료 |
| **스케줄 뷰** | `ScheduleView.tsx` (57KB) | 월간/주간 캘린더, 이벤트 바 레이아웃, 드래그&드롭 | ✅ 완료 |
| **팀 뷰** | `TeamView.tsx` (19KB) | 팀원별 작업 통계, 프로그레스 링, 부서별 분포 | ✅ 완료 |
| **내 할일 위젯** | `MyTasksWidget.tsx` (1198줄) | 할당 씬 + 개인 투두, 캘린더 연동, 드래그 정렬 | ✅ 완료 |
| **캘린더 위젯** | `CalendarWidget.tsx` (358줄) | 대시보드 미니 캘린더, 이벤트 히트맵, 필터링 | ✅ 완료 |
| **위젯 팝업/도킹** | `WidgetPopup.tsx` (635줄) | AOT 토글, 독 모드, 모핑 트랜지션, 7개 위젯 지원 | ✅ 완료 |
| **에피소드 대시보드** | `EpisodeView.tsx` (30KB) | EP별 전용 위젯 (7종), 파트별 상세 | ✅ 완료 |
| **사용자 메뉴** | `UserMenu.tsx` | 사이드바 사용자 프로필, 관리자 전환, 로그아웃 | ✅ 완료 |

---

## 아키텍처 고려사항

### 코드 유지보수 원칙

1. **서비스 레이어 분리**: 모든 데이터 조작은 `services/` 통해서만 (뷰에서 직접 API 호출 금지)
2. **낙관적 업데이트 패턴 통일**: 모든 CRUD는 `store.xxxOptimistic()` → 백그라운드 동기화
3. **타입 안전성**: 새 필드/단계 추가 시 `types/index.ts`에서 시작하여 컴파일 에러로 가이드
4. **컴포넌트 재사용**: 씬 카드, 프로그레스 바, 필터 칩 등 `components/ui/`에 분리
5. **테스트 모드 동등성**: 모든 기능은 테스트 모드에서도 100% 동작해야 함 *(Phase 0-3 검토 후 폐지 가능)*
6. **배치 우선**: 복수 동작은 개별 HTTP 요청 대신 `batch` 엔드포인트로 원자적 처리

### 파일 구조 확장 계획

```
src/
├── components/
│   ├── ui/           ← 공통 UI (Button, Modal, Tag, ProgressBar...)
│   ├── scenes/       ← 씬 관련 (SceneCard, SceneForm, ImagePreview...)
│   ├── layout/       ← 레이아웃 (MainLayout, Sidebar, Header)
│   └── widgets/      ← 대시보드 위젯
├── views/
│   ├── Dashboard.tsx
│   ├── ScenesView.tsx
│   ├── EpisodeView.tsx     ← P4 신규
│   ├── CalendarView.tsx    ← P4 신규
│   ├── AssigneeView.tsx    ← P4 신규
│   └── SettingsView.tsx
├── components/
│   └── spotlight/
│       └── SpotlightSearch.tsx  ← P7 스포트라이트 검색
├── services/
│   ├── sheetsService.ts      ← GAS 연동
│   ├── testSheetService.ts   ← 테스트 모드
│   ├── imageService.ts       ← P2 이미지 업로드/캐싱
│   ├── slackService.ts       ← P3 슬랙 웹훅
│   └── settingsService.ts
├── stores/
│   ├── useDataStore.ts       ← 에피소드/씬 데이터 + 낙관적 업데이트
│   ├── useAppStore.ts        ← UI 상태 (뷰, 필터, 연결상태)
│   ├── useNotificationStore.ts  ← P3 알림 상태
│   ├── useDepartmentStore.ts  ← P6 부서별 설정/상태
│   └── useWidgetStore.ts     ← P7 위젯 레이아웃/AOT 상태
├── types/
│   └── index.ts              ← 모든 타입 정의 (Stage, Scene, Episode, Department...)
└── utils/
    ├── calcStats.ts
    ├── cn.ts
    └── formatters.ts         ← 날짜, 숫자 포맷 유틸
```

---

## 참고한 도구 및 UX 패턴

| 도구 | 주요 참고 패턴 |
|------|--------------|
| **ShotGrid** (Autodesk) | 리스트/썸네일/디테일 3단 뷰 토글, 캔버스 대시보드, 간트 리소스 플래닝 |
| **ftrack** | 멀티레벨 그룹핑, 오버레이 이미지 비교, 칸반 태스크 보드, 워크플로 스키마 |
| **Kitsu** (CGWire) | 상태 매트릭스 뷰, 클립보드 붙여넣기, 네이티브 Slack 연동, 간트 자동생성, 쿼터 추적 |
| **Asana** | 선택적 완료 축하 애니메이션 (비차단, 토글 가능) |
| **Linear** | 미니멀 UI, 키보드 단축키 중심, 빠른 상태 전환 |
| **iOS 홈 화면** | 위젯 편집 wiggle 애니메이션, 위젯 추가/제거 UX |
| **macOS Spotlight** | Ctrl+Space 글로벌 검색, 블러 배경, 카테고리별 결과 |
| **Raycast** | 검색 + 빠른 액션, 퍼지 매칭, 키보드 네비게이션 |
| **Windows 위젯** | AOT 바탕화면 위젯, 글래스 효과, 프레임리스 윈도우 |
| **Duolingo** | 진행률별 격려 메시지, 게이미피케이션 |

---

*이 문서는 새 기능 기획/구현 시 매번 갱신하며, CLAUDE.md에서 참조합니다.*
